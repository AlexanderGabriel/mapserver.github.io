<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Alimentation du cache &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../index.html" />
    <link rel="up" title="MapCache 1.4" href="index.html" />
    <link rel="next" title="Types de cache" href="caches.html" />
    <link rel="prev" title="Services de tuilage supportés" href="services.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/seed.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/seed.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/seed.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/seed.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/seed.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/seed.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/seed.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/seed.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/seed.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/seed.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/seed.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/seed.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/seed.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        
        
          
            <a href="../../uk/mapcache/seed.html"><img src="../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
          
        

    </td>
  </tr>
</table>


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="seeder">
<span id="mapcache-seed"></span><h1>Alimentation du cache<a class="headerlink" href="#seeder" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Mathieu Coudert</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">mathieu.coudert at gmail.com</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Mod-mapcache fournit un outils de génération, dont les principales fonctionnalités sont :</dt>
<dd><ul class="first last simple">
<li><p class="first">Nombre de process d&#8217;alimentation configurable, pour accélérer le rendu</p>
</li>
<li><p class="first">capacité à régénérer certaines tuiles plus âgées qu&#8217;une date particulière</p>
</li>
<li><p class="first">capacité à générer les tuiles d&#8217;après une source de données shapefile/ogr</p>
</li>
</ul>
</dd>
</dl>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;utilitaire de génération de tuile est nommé mapcache_seed et est situé sous le répertoire d&#8217;installation (/usr/local/bin par défaut).</p>
<div class="section" id="commandline-options">
<h3>Options de ligne de commande<a class="headerlink" href="#commandline-options" title="Lien permanent vers ce titre">¶</a></h3>
<p>Des options sont disponibles sous forme courtes ou longues (i.e. -c ou &#8211;config).</p>
<p><strong>-c | &#8211;config [file]</strong> : chemin vers le fichier de configuration mapcache.xml qui contient les tilesets qui nécessitent d&#8217;être générés.</p>
<p><strong>-D | &#8211;dimension &#8220;DIMENSION=VALEUR&#8221;</strong>: utilisé pour définir quelle dimension utiliser si le tileset gère les dimensions. Peut être utilisé plusieurs fois pour définir plusieurs dimensions, e.g. -D &#8220;DIM1=VAL1&#8221; -D &#8220;DIM2=VAL2&#8221;.</p>
<p><strong>-e | &#8211;extent minx,miny,maxx,maxy</strong>: boîte englobante de la surface à générer.</p>
<p><strong>-f | &#8211;force</strong> : force la création des tuiles une deuxième fois si elle existe déjà.</p>
<p><strong>-g | &#8211;grid [grid]</strong>: nom de la grille qui doit être remplie (le tileset sélectionné doit référencer la grille donnée).</p>
<p><strong>-h | &#8211;help</strong>: affiche l&#8217;aide</p>
<p><strong>-i | &#8211;iteration-mode</strong>: soit &#8220;<em>drill-down</em>&#8221; ou &#8220;<em>level-by-level</em>&#8221;. drill-down est la valeur par défaut pour les grilles g, WGS84 et GoogleMapsCompatible, et level-by-level pour les autres. Utilisez cette option pour imposer votre valeur.</p>
<p><strong>-m | &#8211;mode</strong>: le mode à utiliser par le seedeur : seed, delete ou transfer. seed par défaut (<em>mode: seed</em>).</p>
<p><strong>-M | &#8211;metasize</strong>: écrase la taille de metatile lors de la génération des tuiles eg. 8,8.</p>
<p><strong>-n | &#8211;nthreads</strong>: nombre de threads parallèles qui doit être utilisé pour demander les tuiles au WMS source. La valeur par défaut est 1, mais peut être définie plus haute si le serveur WMS peut supporter des requêtes parallèles (une astuce est que cette valeur ne doit jamais dépasser le nombre de CPU sur le serveur WMS).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">cette option est incompatible avec l&#8217;option <strong>-p | &#8211;nprocesses</strong>.</p>
</div>
<p><strong>-o | &#8211;older [timestamp|now]</strong>: génère seulement les tuiles qui sont plus anciennes que la date donnée. La valeur peut être soit la chaîne &#8220;now&#8221;, ou une date formatée de cette manière : year/month/day hour:minute, eg : &#8220;2011/01/31 20:45&#8221;.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">un timestamp doit être mis entre guillemet.</p>
</div>
<p><strong>-p | &#8211;nprocesses</strong> : nombre de processus parallèles qui doit être utilisés pour demander les tuiles à partir du WMS source.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">cette option est incompatible avec l&#8217;option <strong>-n | &#8211;nthreads</strong>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Lorsqu&#8217;on travail avec plusieurs processus (option -p) et des backends de cache sqlite, des erreurs peuvent apparaître sous forte charge lors de l&#8217;écriture vers la base de données sqlite (erreur : erreur de logique SQL ou base de données manquante (1)). Mettre à jour sqlite &gt;=3.7.15 semble corriger le problème.</p>
</div>
<p><strong>-q | &#8211;quiet</strong> : n&#8217;affiche pas les messages de progression vers la sortie standard.</p>
<p><strong>-t | &#8211;tileset [tileset]</strong>: nom du tileset qui doit rempli.</p>
<p><strong>-v | &#8211;verbose</strong>: affiche des informations de débugage verbeux (si compilé).</p>
<p><strong>-x | &#8211;transfer</strong> : le tileset à transférer lorsque la génération des tuiles est utilisé en mode transfert.</p>
<p><strong>-z | &#8211;zoom minzoom,maxzoom</strong>: niveaux de zoom de départ et de fin qui doit être rempli.</p>
</div>
<div class="section" id="optional-commandline-options-when-using-ogr-geos">
<h3>Options de ligne de commande quand on utilise OGR/GEOS<a class="headerlink" href="#optional-commandline-options-when-using-ogr-geos" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si au moment de la compilation ogr et geos ont été trouvés sur le système, l&#8217;outil d&#8217;alimentation autorise des options complémentaires pour ne générer que les tuiles qui recouvrent une aire géographique quelconque. <em>Important:</em> Remarquez bien que pour le moment, les sources de données OGR devraient être dans la même projection que la grille utilisée, car il n&#8217;y a pas de reprojection automatique de la projection de la source de données vers celle de la grille.</p>
<p><strong>-d | &#8211;ogr-datasource [ogr_datasource]</strong>: connection ogr à la source spatiale. Consultez la documentation d&#8217;OGR pour tout ce qui est gérés. Le cas le plus simples (e.g. un Shapefile), c&#8217;est simplement le nom du fichier complet du shapefile.</p>
<p><strong>-l | &#8211;ogr-layer [ogr_layer]</strong>: pour les sources de données qui contiennent plusieurs couches (e.g. postgis, avec plusieurs tables), détermine quelle couche sera utilisée.</p>
<p><strong>-s | &#8211;ogr-sql [ogr_sql]</strong>: expression sql d&#8217;OGR qui peut être appliquée (voir <a class="reference external" href="http://www.gdal.org/ogr/ogr_sql.html">OGR SQL</a>).</p>
<p><strong>-w | &#8211;ogr-where [ogr_where]</strong>: expression sql &#8220;where&#8221; pour filtrer les valeurs retournées.  Cela serait typiquement utilisé pour sélectionner la géométrie d&#8217;un pays donné si la source de données contient toutes les frontières mondiales.</p>
</div>
<div class="section" id="important-note">
<h3>Note importante<a class="headerlink" href="#important-note" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;utilitaire d&#8217;alimentation doit être lancé avec le même compte utilisateur que celui qui fait tourner le serveur web. Cela est nécessaire pour que les permissions sur les tuiles et répertoires créés lors de la pré-génération soit ensuite accessible par le serveur web, et que réciproquement l&#8217;utilitaire d&#8217;alimentation puisse écrire dans les répertoires créés initialement par le serveur web.</p>
<p>Un session de pré-génération peut ressembler à ceci</p>
<div class="highlight-python"><div class="highlight"><pre>[user@host]$ sudo www-data
[www-data@host]$ /path/to/mapcache/src/mapcache_seed -c /path/to/www/conf/mapcache.xml [[options]]
[www-data@host]$ logout
[user@host]$
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h3>Exemples<a class="headerlink" href="#examples" title="Lien permanent vers ce titre">¶</a></h3>
<p>Génère le jeu de tuiles &#8220;osm&#8221; en utilisant la grille &#8220;g&#8221; (google/web-mercator):</p>
<div class="highlight-python"><div class="highlight"><pre>./src/mapcache_seed -c mapcache.xml -t osm -g g
</pre></div>
</div>
<p>Niveaux de pré-génération de 0 à 12:</p>
<div class="highlight-python"><div class="highlight"><pre>./src/mapcache_seed -c mapcache.xml -t osm -g g -z 0,12
</pre></div>
</div>
<p>A partir d&#8217;un shapefile contenant les frontières des pays, ne générer que les zones couvertes par la terre (donc éviter les océans). Utiliser pour cela 4 threads en parallèle:</p>
<div class="highlight-python"><div class="highlight"><pre>./src/mapcache_seed -c mapcache.xml -t osm -g g -z 0,12 -n 4 -d /path/to/seed.shp
</pre></div>
</div>
<p>Pareil que précédemment, mais générer uniquement les USA (remarquez l&#8217;utilisation des apostrophes, destinées à créer un sql valide avec un &#8216;US&#8217; en apostrophes simples:</p>
<div class="highlight-python"><div class="highlight"><pre>./src/mapcache_seed -c mapcache.xml -t osm -g g -z 0,12 -n 4 -d /path/to/seed.shp -w &quot;FIPS_A2=&#39;US&#39;&quot;
</pre></div>
</div>
<p>Régénérer les niveaux 0 à 12 (cela pourrait aussi être fait en supprimant du cache les niveaux 0 à 12 puis en faisant une pré-génération classique, mais faire ainsi ne ralentit pas les accès faits par les clients web):</p>
<div class="highlight-python"><div class="highlight"><pre>./src/mapcache_seed -c mapcache.xml -t osm -g g -z 0,12 -o now
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Alimentation du cache</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#commandline-options">Options de ligne de commande</a></li>
<li><a class="reference internal" href="#optional-commandline-options-when-using-ogr-geos">Options de ligne de commande quand on utilise OGR/GEOS</a></li>
<li><a class="reference internal" href="#important-note">Note importante</a></li>
<li><a class="reference internal" href="#examples">Exemples</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Regents of the University of Minnesota.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>