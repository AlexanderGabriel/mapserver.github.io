
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Dimensions d’un jeu de tuiles &#8212; MapServer 7.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="HTTP Requests" href="http.html" />
    <link rel="prev" title="Formats d’image" href="formats.html" /> 
  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/dimensions.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/dimensions.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/dimensions.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/dimensions.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/dimensions.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/dimensions.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/dimensions.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/dimensions.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/dimensions.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/dimensions.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/dimensions.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/dimensions.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/dimensions.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.2.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tileset-dimensions">
<span id="mapcache-dimensions"></span><h1>Dimensions d’un jeu de tuiles<a class="headerlink" href="#tileset-dimensions" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Seth Girvin</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">sgirvin at compass.ie</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Jerome Boue</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Updated:</th><td class="field-body">2018/05/04</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">1.6.1</td>
</tr>
</tbody>
</table>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les couches WMS dans MapServer peuvent supporter les dimensions, voir <a class="reference internal" href="../ogc/wms_dimension.html#wms-dimension"><span class="std std-ref">WMS Dimension</span></a> pour les détails. MapCache supporte également les dimensions pour les jeux de tuiles.</p>
<p>Stocker des caches de tuiles distincts pour différentes dimensions est utile dans un certain nombre de situations comme créer des caches pour différentes limites spatiales, altitudes ou périodes de temps. Cela fournit aussi un mécanisme pour changer de Mapfile selon une valeur de dimension donnée.</p>
<p>MapCache utilise les dimensions pour:</p>
<blockquote>
<div><ul class="simple">
<li>créer la structure de dossiers des caches disque et SQLite qui utilisent la variable de substitution <code class="docutils literal notranslate"><span class="pre">{dim}</span></code> dans le <em>template</em> de leur configuration, voir <em>Template Structure</em> dans <a class="reference internal" href="caches.html#mapcache-cache-disk"><span class="std std-ref">Caches disque</span></a> et <em>Using Multiple SQLite Database Files</em> dans <a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">Caches SQLite</span></a>.</li>
<li>créer le schéma de données des caches SQLite qui utilisent la variable de substitution <code class="docutils literal notranslate"><span class="pre">:dim</span></code>, voir <em>Custom Schema</em> dans <a class="reference internal" href="caches.html#mapcache-cache-sqlite"><span class="std std-ref">Caches SQLite</span></a>.</li>
<li>construire les requêtes à destination des sources WMS: toute dimension spécifiée pour un jeu de tuile est transmise à sa source WMS lorsqu’un défaut de cache survient.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="enabling-dimension-support-in-mapcache">
<h2>Activation des dimensions dans MapCache<a class="headerlink" href="#enabling-dimension-support-in-mapcache" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les dimensions sont activées dans le fichier de configuration au niveau du <a class="reference internal" href="config.html#mapcache-config-tileset"><span class="std std-ref">Jeu de tuiles</span></a>. Chaque jeu de tuile peut définir ses propres dimensions à l’aide d’une section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> qui inclut un ou plusieurs éléments <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code>.</p>
<div class="section" id="dimension-attributes">
<h3>Attributs de dimension<a class="headerlink" href="#dimension-attributes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plusieurs attributs sont définis pour l’élément <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> (requis): Le nom de la dimension dans une requête WMS (sans le préfixe <code class="docutils literal notranslate"><span class="pre">dim_</span></code> spécifié dans <a class="reference external" href="http://portal.opengeospatial.org/files/?artifact_id=1081&amp;version=1&amp;format=pdf">WMS 1.1.1 Specification</a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">default</span></code> (requis): La valeur par défaut de la dimension lorsqu’aucune valeur n’est fournie explicitement dans la requête WMS.</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code> (requis): MapCache définit plusieurs façons de spécifier une dimension: <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">regex</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> et <code class="docutils literal notranslate"><span class="pre">time</span></code>. Ces types de dimensions sont décrits dans la suite.</li>
<li><code class="docutils literal notranslate"><span class="pre">unit</span></code> (optionnel): unité physique de la dimension. Cette information n’est utilisée que dans la réponse à une requête GetCapabilities.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="dimension-types">
<h3>Types de dimensions<a class="headerlink" href="#dimension-types" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plusieurs types de dimensions sont supportés par MapCache: <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">regex</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> et <code class="docutils literal notranslate"><span class="pre">time</span></code>. Ils peuvent être classés en deux groupes selon comment les valeurs de la dimension sont définies:</p>
<blockquote>
<div><ul class="simple">
<li>Dimensions de premier niveau: <code class="docutils literal notranslate"><span class="pre">values</span></code> et <code class="docutils literal notranslate"><span class="pre">regex</span></code>. Les valeurs de la dimension sont spécifiées statiquement dans le fichier de configuration.</li>
<li>Dimensions de deuxième niveau: <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> et <code class="docutils literal notranslate"><span class="pre">time</span></code>. Les valeurs de la dimension sont stockées via un mécanisme dynamique (un fichier SQLite) de sorte qu’une modification de ces valeurs ne nécessite pas de redémarrage du serveur MapCache.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="first-level-dimensions">
<h2>Dimensions de premier niveau<a class="headerlink" href="#first-level-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les dimensions de premier niveau définissent leurs valeurs dans le fichier de configuration.</p>
<div class="section" id="values-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">values</span></code><a class="headerlink" href="#values-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une dimension de type <code class="docutils literal notranslate"><span class="pre">values</span></code> donne la liste de toutes ses valeurs possibles. Le nom de la dimension est utilisée comme clé dans une requête WMS ou WMTS, par exemple <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=foobarbaz</span></code>.</p>
<p>Lorsqu’un client ne fournit pas de valeur explicite pour la dimension, alors la valeur par défaut est prise en compte (c’est-à-dire <code class="docutils literal notranslate"><span class="pre">foobar</span></code> dans cet exemple).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;tileset</span> <span class="na">name=</span><span class="s">&quot;LayerName&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source&gt;</span>LayerSource<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;cache&gt;</span>sqlite<span class="nt">&lt;/cache&gt;</span>
    <span class="nt">&lt;grid&gt;</span>GoogleMapsCompatible<span class="nt">&lt;/grid&gt;</span>
    <span class="nt">&lt;format&gt;</span>PNG<span class="nt">&lt;/format&gt;</span>
    <span class="nt">&lt;metatile&gt;</span>5 5<span class="nt">&lt;/metatile&gt;</span>
    <span class="nt">&lt;metabuffer&gt;</span>10<span class="nt">&lt;/metabuffer&gt;</span>
    <span class="nt">&lt;dimensions&gt;</span>
        <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;values&quot;</span> <span class="na">name=</span><span class="s">&quot;DIM1&quot;</span> <span class="na">default=</span><span class="s">&quot;foobar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobar<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobarbaz<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>bar<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/dimension&gt;</span>
    <span class="nt">&lt;/dimensions&gt;</span>
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="regex-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">regex</span></code><a class="headerlink" href="#regex-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une alternative à une liste de valeurs en dur, est l’utilisation d’expressions régulières.</p>
<p>L’exemple suivant crée une dimension MAPFILE, afin d’utiliser le même jeu de tuiles MapCache avec différents Mapfiles MapServer. MapCache n’a pas besoin de connaître les noms des Mapfiles, qui peuvent alors être créés après le démarrage de MapCache.</p>
<p>Lorsqu’un utilisateur passe <code class="docutils literal notranslate"><span class="pre">MAPFILE=/path/to/mapfile</span></code>, MapCache vérifie que la chaîne <code class="docutils literal notranslate"><span class="pre">/path/to/mapfile</span></code> répond à l’expression régulière (PCRE) définie dans le fichier de configuration. Dans cet exemple, l’expression régulière valide un nom composé de caractères alphanumériques séparés par des barres obliques (/) et se terminant par «&nbsp;.map&nbsp;» ( [a-zA-Z0-9./]*.map$ ), mais échoue en présence de deux points consécutifs (..) afin d’empêcher toute traversée du système de fichiers.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;regex&quot;</span> <span class="na">name=</span><span class="s">&quot;MAPFILE&quot;</span> <span class="na">default=</span><span class="s">&quot;/path/to/mapfile.map&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;regex&gt;</span>^(?!.*\.\.)[a-zA-Z0-9\./]*\.map$<span class="nt">&lt;/regex&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="second-level-dimensions">
<h2>Dimensions de deuxième niveau<a class="headerlink" href="#second-level-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les dimensions de deuxième niveau stockent leurs valeurs via un mécanisme dynamique externe, initialement un fichier SQLite. Cela permet d’ajouter de nouvelles valeurs pour la dimension sans modifier le fichier de configuration, ce qui sinon obligerait à redémarrer le serveur.</p>
<div class="section" id="time-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">time</span></code><a class="headerlink" href="#time-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>MapCache supporte les requêtes WMTS et WMS qui incluent un paramètre TIME, aussi bien pour les dates que pour les intervalles de temps. Voir <a class="reference internal" href="../development/rfc/ms-rfc-96.html#rfc96"><span class="std std-ref">MS RFC 96: Time Dimension Support in MapCache Tilesets</span></a> pour plus de détails.</p>
<p>La définition d’une dimension de type <code class="docutils literal notranslate"><span class="pre">time</span></code> met en œuvre un fichier SQLite. Deux éléments sont à spécifier:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;dbfile&gt;</span></code>: Emplacement du fichier SQLite qui sert de support à la dimension de type <code class="docutils literal notranslate"><span class="pre">time</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;query&gt;</span></code>: Requête SQL qui renvoie la liste des valeurs de dates disponibles dans un intervalle de temps donné. Dans cette requête, la date de début et la date de fin sont représentées par les variables de substitution <code class="docutils literal notranslate"><span class="pre">:start_timestamp</span></code> et <code class="docutils literal notranslate"><span class="pre">:end_time_stamp</span></code>. Les valeurs renvoyées doivent être au format de date <code class="docutils literal notranslate"><span class="pre">yyyy-mm-ddThh:mm:ssZ</span></code>, tel que spécifié dans la <a class="reference external" href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> mais restreint à l’UTC.</li>
</ul>
</div></blockquote>
<p>Les valeurs temporelles dans le fichier SQLite sont exprimées en temps Unix, c’est-à-dire un nombre de secondes depuis le premier janvier 1970 à minuit UTC.</p>
<p>Une requête temporelle avec un intervalle peut renvoyer plusieurs valeurs de dates, chacune faisant référence à des tuiles distinctes. Assembler ces tuiles est décrit dans la section <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> plus loin.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;time&quot; dimension</span>

<span class="c">     This example defines a &quot;time&quot; dimension whose possible values are</span>
<span class="c">     stored in the /path/to/mapcache-time.sqlite SQLite file. The default</span>
<span class="c">     value is &quot;2010&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;time=1999-08-11T11:03:07Z/2001-09-21T08:17:56Z&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;time&quot;</span> <span class="na">default=</span><span class="s">&quot;2010&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
    <span class="nt">&lt;query&gt;</span>
         SELECT strftime(&quot;%Y-%m-%dT%H:%M:%SZ&quot;,ts) FROM time
          WHERE ts <span class="ni">&amp;gt;</span>= datetime(:start_timestamp,&quot;unixepoch&quot;)
            AND ts <span class="ni">&amp;lt;</span>= datetime(:end_timestamp,&quot;unixepoch&quot;)
       ORDER BY ts DESC
    <span class="nt">&lt;/query&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sqlite-dimensions">
<h3>Dimensions de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code><a class="headerlink" href="#sqlite-dimensions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans une dimension de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> les valeurs de dimension sont stockées dans un fichier SQLite. De plus, chaque valeur référence une liste de valeurs internes, dites de sous-dimension, qui sont utilisées pour formuler les requêtes au cache.</p>
<p>Par exemple, soit une dimension «&nbsp;sensor&nbsp;» dont les valeurs possibles représentent divers satellites d’observation de la Terre. Une requête WMS avec cette dimension peut contenir: <code class="docutils literal notranslate"><span class="pre">...&amp;dim_sensor=spot&amp;...</span></code> Dans cet exemple, chaque capteur référence plusieurs types de données selon une sous-dimension interne nommée «&nbsp;product&nbsp;». Un exemple du contenu de la dimension «&nbsp;sensor&nbsp;» est représenté sur la table suivante:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dimension «&nbsp;sensor&nbsp;»</th>
<th class="head">Sous-dimension «&nbsp;product&nbsp;»</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>spot</td>
<td>spot-img1</td>
</tr>
<tr class="row-odd"><td>spot</td>
<td>spot-img2</td>
</tr>
<tr class="row-even"><td>phr</td>
<td>phr-img1</td>
</tr>
<tr class="row-odd"><td>phr</td>
<td>phr-img2</td>
</tr>
<tr class="row-even"><td>phr</td>
<td>phr-img3</td>
</tr>
</tbody>
</table>
<p>La requête WMS se passe au niveau de la dimension «&nbsp;sensor&nbsp;». La requête sur le cache a lieu au niveau de la sous-dimension «&nbsp;product&nbsp;». Dans le cas d’un défaut de cache, les valeurs de la sous-dimension «&nbsp;product&nbsp;» sont utilisées pour formuler une requête à la source de données.</p>
<p>Une requête à une dimension de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code> peut alors renvoyer plusieurs valeurs de sous-dimensions, chacune faisant référence à des tuiles distinctes. Assembler ces tuiles est décrit dans la section <a class="reference internal" href="#tile-assembly-policies">Tile Assembly Policies</a> plus loin.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- &quot;sqlite&quot; dimension</span>

<span class="c">     This example defines a &quot;sensor&quot; dimension whose possible values are</span>
<span class="c">     stored in the /data/sensor.sqlite SQLite file. The default value is</span>
<span class="c">     &quot;phr&quot;.</span>

<span class="c">     A WMS request with that dimension may contain, e.g.</span>
<span class="c">     &quot;... &amp;dim_sensor=spot&amp; ...&quot;</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">name=</span><span class="s">&quot;sensor&quot;</span> <span class="na">default=</span><span class="s">&quot;phr&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/data/sensor.sqlite<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;list_query&gt;</span>
      SELECT distinct(product) FROM dim
   <span class="nt">&lt;/list_query&gt;</span>
   <span class="nt">&lt;validate_query&gt;</span>
      SELECT product FROM dim
       WHERE sensor=:dim
   <span class="nt">&lt;/validate_query&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="tile-assembly-policies">
<h3>Politiques d’assemblage des tuiles<a class="headerlink" href="#tile-assembly-policies" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lorsque plusieurs valeurs de temps ou de sous-dimensions sont renvoyées suite à une requête à une dimension de deuxième niveau, la tuile résultante est un assemblage de toutes les tuiles simples associées à chaque valeur. La façon dont ces tuiles sont assemblées est définie avec l’élément <code class="docutils literal notranslate"><span class="pre">&lt;assembly_type&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code>. Seulement deux valeurs sont prises en charge par MapCache:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">none</span></code>: Aucun assemblage n’est réalisé, la tuile résultante est la première tuile récupérée du cache. C’est la valeur par défaut.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">stack</span></code>: Chaque pixel de la tuile résultante est rempli avec le premier pixel opaque trouvé dans toutes les tuiles dans leur ordre de récupération, par exemple:</p>
<table border="1" class="docutils" id="type-d-assemblage-stack">
<caption><span class="caption-text">Type d’assemblage: <code class="docutils literal notranslate"><span class="pre">stack</span></code></span><a class="headerlink" href="#type-d-assemblage-stack" title="Lien permanent vers ce tableau">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-1.png"><img alt="../_images/mapcache-assembly-stack-1.png" src="../_images/mapcache-assembly-stack-1.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-2.png"><img alt="../_images/mapcache-assembly-stack-2.png" src="../_images/mapcache-assembly-stack-2.png" style="width: 148.5px; height: 125.0px;" /></a>
</td>
<td><a class="first last reference internal image-reference" href="../_images/mapcache-assembly-stack-3.png"><img alt="../_images/mapcache-assembly-stack-3.png" src="../_images/mapcache-assembly-stack-3.png" style="width: 149.0px; height: 125.0px;" /></a>
</td>
</tr>
<tr class="row-even"><td>Produit 1</td>
<td>Produit 2</td>
<td>Assemblage <code class="docutils literal notranslate"><span class="pre">stack</span></code> des produits 1 et 2</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div></blockquote>
<p>Il est possible de choisir si la tuile résultante doit être stockée dans le cache ou non, via l’élément <code class="docutils literal notranslate"><span class="pre">&lt;store_assemblies&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code>. Les deux valeurs possibles sont <code class="docutils literal notranslate"><span class="pre">true</span></code> et <code class="docutils literal notranslate"><span class="pre">false</span></code>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>L’élément <code class="docutils literal notranslate"><span class="pre">&lt;subdimensions_read_only&gt;</span></code> de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> indique si la source de données doit être interrogée en cas de défaut de cache. Les deux valeurs possibles sont <code class="docutils literal notranslate"><span class="pre">true</span></code> et <code class="docutils literal notranslate"><span class="pre">false</span></code>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dimensions&gt;</span>
    <span class="nt">&lt;assembly_type&gt;</span>stack<span class="nt">&lt;/assembly_type&gt;</span>
    <span class="nt">&lt;store_assemblies&gt;</span>true<span class="nt">&lt;/store_assemblies&gt;</span>
    <span class="nt">&lt;subdimensions_read_only&gt;</span>false<span class="nt">&lt;/subdimensions_read_only&gt;</span>
    <span class="nt">&lt;dimension</span> <span class="nt">&gt;</span>...<span class="nt">&lt;/dimension&gt;</span>
<span class="nt">&lt;/dimensions&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="storing-dimensions">
<h2>Stockage des dimensions<a class="headerlink" href="#storing-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans un cache de type disque, les tuiles sont stockées dans une structure de dossier ressemblant à <code class="docutils literal notranslate"><span class="pre">base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png</span></code> (où DIM1 est la valeur de dimension).</p>
<p>L’ordre des éléments <code class="docutils literal notranslate"><span class="pre">&lt;dimension&gt;</span></code> à l’intérieur de la section <code class="docutils literal notranslate"><span class="pre">&lt;dimensions&gt;</span></code> est important car il est utilisé pour créer la structure de répertoires pour le cache de type disque. Si l’ordre est modifié, toutes les tuiles qui ont été déjà stockées dans le cache sont invalidées (elles deviennent inaccessibles à MapCache mais ne sont pas détruites).</p>
<p>Les «&nbsp;templates&nbsp;» peuvent être utilisés pour adapter la structure des dossiers, par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les «&nbsp;templates&nbsp;» peuvent aussi être utilisés pour adapter le nom d’un fichier SQLite, par exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- the following will create databases named TilesetName-#DimensionValue.db --&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>{tileset}-{dim}.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-tile-caches-with-dimensions">
<h2>Accès à un cache de tuiles à l’aide des dimensions<a class="headerlink" href="#accessing-tile-caches-with-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour obtenir une tuile avec une dimension spécifique, il suffit d’ajouter le nom de la dimension et sa valeur à la requête, par exemple: <code class="docutils literal notranslate"><span class="pre">&amp;DIM1=value</span></code></p>
<p>Seuls les clients WMS et WMTS supportent le passage des dimensions à MapCache. Les autres services de tuiles, tels que gmaps (GoogleMaps), tms et KML ne supportent pas les dimensions. Toutefois, WMTS permet l’accès à une tuile selon un schéma d’adressage x,y,z, ce qui ouvre la possibilité à des clients de tuiles (par exemple une couche OpenLayers <code class="docutils literal notranslate"><span class="pre">ol.source.XYZ</span></code>) d’accéder à un jeu de tuiles avec dimensions grâce à une réécriture d’URL sur le serveur web.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a URL such as the following</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">tiles</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">3914</span><span class="o">/</span><span class="mf">2687.</span><span class="n">png</span>
<span class="c1"># can be rewritten into a WMTS request - note WMTS uses {z}/{y}/{x} rather than {z}/{x}/{y}</span>
<span class="c1"># so these values need to be swapped</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">mapcache</span><span class="o">/</span><span class="n">wmts</span><span class="o">/</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">layername</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dimension</span><span class="o">/</span><span class="n">GoogleMapsCompatible</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2687</span><span class="o">/</span><span class="mf">3914.</span><span class="n">png</span>
</pre></div>
</div>
</div>
<div class="section" id="seeding-tile-caches-with-dimensions">
<h2>Alimenter un cache de tuiles à l’aide des dimensions<a class="headerlink" href="#seeding-tile-caches-with-dimensions" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference internal" href="seed.html#mapcache-seed"><span class="std std-ref">L’outil d’alimentation de MapCache</span></a> autorise d’alimenter des dimensions spécifiques avec la syntaxe suivante:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>mapcache_seed -c mapcache_config.xml -t tileset1 -e -1187000,6695000,-605000,7450000 -z 7,10 --dimension DIMENSION_NAME=DIMENSION_VALUE
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dimensions d’un jeu de tuiles</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#enabling-dimension-support-in-mapcache">Activation des dimensions dans MapCache</a><ul>
<li><a class="reference internal" href="#dimension-attributes">Attributs de dimension</a></li>
<li><a class="reference internal" href="#dimension-types">Types de dimensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#first-level-dimensions">Dimensions de premier niveau</a><ul>
<li><a class="reference internal" href="#values-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">values</span></code></a></li>
<li><a class="reference internal" href="#regex-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">regex</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#second-level-dimensions">Dimensions de deuxième niveau</a><ul>
<li><a class="reference internal" href="#time-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">time</span></code></a></li>
<li><a class="reference internal" href="#sqlite-dimensions">Dimensions de type <code class="docutils literal notranslate"><span class="pre">sqlite</span></code></a></li>
<li><a class="reference internal" href="#tile-assembly-policies">Politiques d’assemblage des tuiles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storing-dimensions">Stockage des dimensions</a></li>
<li><a class="reference internal" href="#accessing-tile-caches-with-dimensions">Accès à un cache de tuiles à l’aide des dimensions</a></li>
<li><a class="reference internal" href="#seeding-tile-caches-with-dimensions">Alimenter un cache de tuiles à l’aide des dimensions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             >suivant</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Formats d’image"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.2.0 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2018, Open Source Geospatial Foundation.
      Mis à jour le 2018-07-31.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>