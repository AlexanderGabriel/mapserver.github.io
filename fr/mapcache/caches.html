<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Types de cache &mdash; MapServer 7.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="À propos de ces documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.0 documentation" href="../index.html" />
    <link rel="up" title="MapCache 1.4" href="index.html" />
    <link rel="next" title="Formats d’image" href="formats.html" />
    <link rel="prev" title="Alimentation du cache" href="seed.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/caches.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../ar/mapcache/caches.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
          
        
        
          
            <a href="../../de/mapcache/caches.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/caches.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/caches.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" width="18px" height="13px"/>
        
          
            <a href="../../id/mapcache/caches.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/caches.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../ja/mapcache/caches.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
          
        
        
          
            <a href="../../nl_NL/mapcache/caches.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
          
        
        
          
            <a href="../../pl/mapcache/caches.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
          
        
        
          
            <a href="../../ru/mapcache/caches.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/caches.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/caches.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        
        
          
            <a href="../../uk/mapcache/caches.html"><img src="../_static/flagicons/uk.png" alt="uk" title="uk" border="0" /></a>
          
        

    </td>
  </tr>
</table>


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cache-types">
<span id="mapcache-caches"></span><h1>Types de cache<a class="headerlink" href="#cache-types" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
</tbody>
</table>
<p>Ce document détaille les différents backend pour le cache qui peuvent être utilisés pour stocker des tuiles</p>
<div class="section" id="disk-caches">
<span id="mapcache-cache-disk"></span><h2>Caches disque<a class="headerlink" href="#disk-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>The disk based cache is the simplest cache to configure, and the one with the
the fastest access to existing tiles. It is ideal for small tile repositories,
but will often cause trouble for sites hosting millions of tiles, as the number of
files or directory may rapidly overcome the capabilities of the underlying
filesystem. Additionaly, the block size chosen for the filesystem must closely
match the mean size of a stored tile: ideally, any given tile should just fit
inside a filesystem block, so as not to waste storage space inside each block,
and not have to use up multiple blocks per tile.</p>
<p>L&#8217;emplacement des répertoires/fichiers doit être en lecture/écriture pour l&#8217;utilisateur qui fait fonctionner le serveur de tuiles.</p>
<div class="section" id="common-configuration">
<h3>Common Configuration<a class="headerlink" href="#common-configuration" title="Lien permanent vers ce titre">¶</a></h3>
<p>Disk caches are added via</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;disk_cache&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;...&quot;</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;symlink_blank/&gt;</span>
  <span class="nt">&lt;creation_retry&gt;</span>3<span class="nt">&lt;/creation_retry&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>All caches except the &#8220;template&#8221; one support the &lt;symlink_blank/&gt; option which
(depending on platform availability) will detect tiles of uniform color and
create a symbolic link to a single uniform color tile instead of storing the
actual blank data in the tile&#8217;s file.</p>
<p>All caches support the &lt;creation_retry&gt; option, which specifies the number of
times mapcache should retry if it failed to create a tile&#8217;s file or symlink. The
default is to fail immediately, you may want to set this to a positive value
if using a network mounted filesystem where transient errors are common.</p>
</div>
<div class="section" id="default-structure">
<h3>Structure par défaut<a class="headerlink" href="#default-structure" title="Lien permanent vers ce titre">¶</a></h3>
<p>The default disk cache stores tiles in a structure nearly identical to the
file/directory hierarchy used by TileCache. The only change is that a top level
directory structure corresponding to the name of the grid and the eventual value
of the tileset&#8217;s dimensions is added.</p>
<p>Ce cache est capable de détecter les tuiles &#8220;blanches&#8221; (c&#8217;est à dire avec une couleur uniforme) et d&#8217;utiliser un lien symbolique vers une seule tuile &#8220;blanche&#8221;pour gagner de l&#8217;espace disque.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;disk&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les deux seules clés dans la configuration sont le répertoire racine où les tuiles seront stockées, et la clé pour activer la mise en lien symbolique des tuiles vides</p>
</div>
<div class="section" id="arcgis-compatible-structure">
<h3>Arcgis Compatible Structure<a class="headerlink" href="#arcgis-compatible-structure" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;arcgis&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;arcgis&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>This layout creates a tile structure compatible with an arcgis exploded cache. Tiles
will be stored in files that ressemble <cite>/tmp/{tileset}/{grid}/{dimension}/L{z}/R{y}/C{x}.{ext}</cite></p>
</div>
<div class="section" id="worldwind-compatible-structure">
<h3>Worldwind Compatible Structure<a class="headerlink" href="#worldwind-compatible-structure" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;worldwind&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;worldwind&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp<span class="nt">&lt;/base&gt;</span>
   <span class="nt">&lt;symlink_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>This layout creates a tile structure compatible with a worldwind cache. Tiles
will be stored in files that ressemble <cite>/tmp/{tileset}/{grid}/{dimension}/{z}/{y}/{y}_{x}.ext</cite></p>
</div>
<div class="section" id="template-structure">
<h3>Structure du &#8220;template&#8221;<a class="headerlink" href="#template-structure" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le modèle basé sur le cache disque vous permet de créer (ou réutiliser) une structure de tuiles (existante) que vous avez défini à l&#8217;avance. Le paramètre &lt;template&gt; prend une chaîne en argument où les différentes entrées du modèle seront remplacées à l&#8217;exécution par la valeur correcte pour chacune des tuiles à stocker.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span> <span class="na">layout=</span><span class="s">&quot;template&quot;</span><span class="nt">&gt;</span>
   <span class="c">&lt;!-- template</span>

<span class="c">       string template that will be used to map a tile (by tileset, grid name, dimension,</span>
<span class="c">       format, x, y, and z) to a filename on the filesystem.</span>
<span class="c">       the following replacements are performed:</span>
<span class="c">       - {tileset} : the tileset name</span>
<span class="c">       - {grid} : the grid name</span>
<span class="c">       - {dim} : a string that concatenates the tile&#39;s dimension</span>
<span class="c">       - {ext} : the filename extension for the tile&#39;s image format</span>
<span class="c">       - {x},{y},{z} : the tile x,y,z values</span>
<span class="c">       - {inv_x}, {inv_y}, {inv_z} : inverted x,y,z values (inv_x = level-&gt;maxx - x - 1). This</span>
<span class="c">            is mainly used to support grids where one axis is inverted (e.g. the google schema)</span>
<span class="c">            and you want to create on offline cache.</span>

<span class="c">      * note that this type of cache does not support blank-tile detection and symlinking.</span>

<span class="c">      * warning: it is up to you to make sure that the template you chose creates a unique</span>
<span class="c">        filename for your given tilesets. e.g. do not ommit the {grid} parameter if your</span>
<span class="c">        tilesets reference multiple grids. Failure to do so will result in filename</span>
<span class="c">        collisions !</span>

<span class="c">   --&gt;</span>
   <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="berkeleydb-caches">
<span id="mapcache-cache-bdb"></span><h2>Caches BerkeleyDB<a class="headerlink" href="#berkeleydb-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le cache du backend BerkeleyDB stocke les tuiles dans une base de données clé-valeur à plat et donc n&#8217;a pas les désavantages des caches disques au regard du nombre de fichiers de tuiles stockées sur le système de fichiers. Comme les &#8220;blobs&#8221; d&#8217;images sont stockés de manière contiguë, la taille du bloc choisi pour le système de fichiers n&#8217;a pas d&#8217;influence sur la capacité de stockage du volume.</p>
<p>Notez que pour un cache BerkeleyDB donné, seule un seul fichier de base de données est créé, qui stockera les tuiles des jeux de tuiles associés (c&#8217;est à dire qu&#8217;il n&#8217;y a pas de fichier de base de données créé par jeu de tuiles, grilles, et ou dimensions). Si vous avez besoin de stocker différents jeux de donnés dans différents fichiers, alors utilisez de multiples entrées dans le cache BerkeleyDB. Il n&#8217;est pas possible d&#8217;utiliser de multiples fichiers de base de données pour des grilles de jeux de tuiles ou des dimensions.</p>
<p>Les caches basés sur BerkeleyDB sont un peu plus rapides que les caches basés sur le stockage disque mais sont un peu plus lents pour les écritures concurrentes si de nombreux threads essayent tous d&#8217;insérer des tuiles de manière concurrentes.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;bdb&quot;</span> <span class="na">type=</span><span class="s">&quot;bdb&quot;</span><span class="nt">&gt;</span>
   <span class="c">&lt;!-- base (required)</span>
<span class="c">      absolute filesystem path where the berkeley db database file is to be stored.</span>
<span class="c">      this directory must exist, and be writable</span>
<span class="c">   --&gt;</span>
   <span class="nt">&lt;base&gt;</span>/tmp/foo/<span class="nt">&lt;/base&gt;</span>

   <span class="c">&lt;!-- key_template (optional)</span>
<span class="c">      string template used to create the key for a tile entry in the database.</span>
<span class="c">      defaults to the value below. you should include {tileset}, {grid} and {dim} here</span>
<span class="c">      unless you know what you are doing, or you will end up with mixed tiles</span>
<span class="c">   &lt;key_template&gt;{tileset}-{grid}-{dim}-{z}-{y}-{x}.{ext}&lt;/key_template&gt;</span>
<span class="c">   --&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sqlite-caches">
<span id="mapcache-cache-sqlite"></span><h2>Caches Sqlite<a class="headerlink" href="#sqlite-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il y a deux caches sqlite différents qui varient par le schéma de la base de données qu&#8217;ils créent et interrogent. Les caches Sqlite ont l&#8217;avantage qu&#8217;ils stockent les tuiles dans des &#8220;blobs&#8221; dans une seule base de données et donc ils n&#8217;ont pas les désavantages des caches disques au regard du nombre de fichiers de tuiles stockées. Comme les &#8220;blobs&#8221; d&#8217;images sont stockés de manière contiguë, la taille du bloc choisi pour le système de fichiers n&#8217;a pas d&#8217;influence sur la capacité de stockage du volume.</p>
<p>Les caches SQLite sont un peu plus lents que les caches disques, et peuvent avoir des problèmes de blocage en écriture au moment du remplissage si un nombre élevé de threads essaient tous d&#8217;insérer de nouvelles tuiles en même temps.</p>
<div class="section" id="default-schema">
<h3>Schéma par défaut<a class="headerlink" href="#default-schema" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les tuiles sont stockées dans le fichier SQLite configuré créé par MapCache avec</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">tiles</span><span class="p">(</span>
   <span class="n">tileset</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">grid</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">x</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="n">y</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="n">z</span> <span class="nb">integer</span><span class="p">,</span>
   <span class="k">data</span> <span class="nb">blob</span><span class="p">,</span>
   <span class="n">dim</span> <span class="nb">text</span><span class="p">,</span>
   <span class="n">ctime</span> <span class="n">datetime</span><span class="p">,</span>
   <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tileset</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/dbfile.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Vous pouvez également ajouter des commandes pragmas SQLite personnalisées qui seront exécutées lors de la première connexion à la base de données, de sorte à modifier les réglages SQlite par défaut</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;pragma</span> <span class="na">name=</span><span class="s">&quot;max_page_count&quot;</span><span class="nt">&gt;</span>10000000<span class="nt">&lt;/pragma&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les entrées &lt;pragma&gt; résulteront en un appel à</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">PRAGMA</span> <span class="n">max_page_count</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-schema">
<h3>Schéma customisé<a class="headerlink" href="#custom-schema" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ce cache peut utiliser n&#8217;importe quel schéma de base de données. C&#8217;est à vous de fournir le SQL qui sera utilisé pour sélectionner ou insérer une nouvelle tuile.</p>
<p>In order to use such a functionality you should supply the sql queries that will
be used against your custom schema. It is up to you to make sure your queries are
correct and will return the correct data for a given tileset, dimension, grid, x,
y and z.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlitecustom&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;queries&gt;</span>
     <span class="nt">&lt;create&gt;</span>create table if not exists tiles(tileset text, grid text, x integer, y integer, z integer, data blob, dim text, ctime datetime, primary key(tileset,grid,x,y,z,dim))<span class="nt">&lt;/create&gt;</span>
     <span class="nt">&lt;exists&gt;</span>select 1 from tiles where x=:x and y=:y and z=:z and dim=:dim and tileset=:tileset and grid=:grid<span class="nt">&lt;/exists&gt;</span>
     <span class="nt">&lt;get&gt;</span>select data,strftime(&quot;%s&quot;,ctime) from tiles where tileset=:tileset and grid=:grid and x=:x and y=:y and z=:z and dim=:dim<span class="nt">&lt;/get&gt;</span>
     <span class="nt">&lt;set&gt;</span>insert or replace into tiles(tileset,grid,x,y,z,data,dim,ctime) values (:tileset,:grid,:x,:y,:z,:data,:dim,datetime(&#39;now&#39;))<span class="nt">&lt;/set&gt;</span>
     <span class="nt">&lt;delete&gt;</span>delete from tiles where x=:x and y=:y and z=:z and dim=:dim and tileset=:tileset and grid=:grid<span class="nt">&lt;/delete&gt;</span>
   <span class="nt">&lt;/queries&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Note that for the &lt;get&gt; query that returns data for a given tile, the first returned argument
is considered to be the image blob, and the second optional one a timestamp representing the
creation timestamp for that tile.</p>
</div>
<div class="section" id="blank-tile-detection">
<h3>Blank Tile Detection<a class="headerlink" href="#blank-tile-detection" title="Lien permanent vers ce titre">¶</a></h3>
<p>Mapcache&#8217;s sqlite caches support the detection and storage of blank (i.e. uniform
color) tiles, and will store a quadruplet of the rgba color component in the data
blob instead of the compressed image data itself. That quadruplet will be
transformed on-the-fly to a 1-bit paletted png before being returned to the client.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqliteblank&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/tmp/sqlitefile.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">sqlite files created with this option will only be fully understood by
mapcache as each tile blob may contain a #rgba quadruplet instead of
the expected png or jpeg data.</p>
</div>
</div>
<div class="section" id="using-multiple-sqlite-database-files">
<h3>Using multiple sqlite database files<a class="headerlink" href="#using-multiple-sqlite-database-files" title="Lien permanent vers ce titre">¶</a></h3>
<p>You may want to split an sqlite cache into multiple files, for organisational
purposes, or to keep the size of each file to a reasonable limit if caching
large amounts of data.</p>
<p>In order to do so you may use a template to determine which file should be
used for a given file:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/{grid}/{dim}/{tileset}.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>You may also limit the x and y number of tiles to be stored inside a single database
file:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/path/to/{grid}/{dim}/{tileset}/{z}/{x}-{y}.sqlite3<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;xcount&gt;</span>1000<span class="nt">&lt;/xcount&gt;</span>
   <span class="nt">&lt;ycount&gt;</span>1000<span class="nt">&lt;/ycount&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>In this case you <strong>should</strong> include the {x}, {y} and {z} replacements in the
template determining the file to use.
In the previous example, tile (z,x,y)=(15,3024,1534) would be stored in a file
named /path/to/g/mytileset/15/3000-1000.sqlite3 and tile (5,2,8) would be stored
in a file named /path/to/g/mytileset/5/0-0.sqlite3</p>
<p>Les paramètres suivants sont disponibles pour manipuler les x,y et z d&#8217;une tuile donnée</p>
<ul class="simple">
<li><cite>{z}</cite> is replaced by the zoom level</li>
<li><cite>{x}</cite> is replaced by the x value of the leftmost tile inside the sqlite file
containing the requested tile</li>
<li><cite>{inv_x}</cite> is replaced by the x value of the rightmost tile.</li>
<li><cite>{y}</cite> is replaced by the y value of the bottommost tile.</li>
<li><cite>{inv_y}</cite> is replaced by the y value of the topmost tile.</li>
<li><cite>{div_x}</cite> is replaced by the index of the sqlite file starting from the left
of the grid (i.e. <cite>{div_x} = {x}/&lt;xcount&gt;</cite>)</li>
<li><cite>{inv_div_x}</cite> same as {div_x} but starting from the right.</li>
<li><cite>{div_y}</cite> is replaced by the index of the sqlite file starting from the bottom
of the grid (i.e. <cite>{div_y} = {y}/&lt;ycount&gt;</cite>)</li>
<li><cite>{inv_div_y}</cite> same as <cite>{div_y}</cite> but starting from the top.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">{inv_x} and {inv_div_x} will probably be rarely used, whereas
{inv_y} and {inv_div_y} will find some usage for people who prefer to index
their dbfiles files from top to bottom rather than bottom to top.</p>
</div>
<p>In some occurences, it may be desirable to have a precise hand on the
filename to use for a given x,y,z, tile lookup, e.g. to look for a file
named <cite>Z03-R00003-C000009.sqlite3</cite> instead of just <cite>Z3-R3-C9.sqlite3</cite>. The
&lt;dbfile&gt; entry supports formatting attributes, following the unix
printf syntax ( c.f.: <a class="reference external" href="http://linux.die.net/man/3/printf">http://linux.die.net/man/3/printf</a> ), by suffixing
each template key with &#8220;_fmt&#8221;, e.g.:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mysqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile</span>
      <span class="na">x_fmt=</span><span class="s">&quot;%08d&quot;</span>
      <span class="na">inv_y_fmt=</span><span class="s">&quot;%08d&quot;</span>
   <span class="nt">&gt;</span>/data/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.sqlite<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sans indication, le fonctionnement par défaut utilise &#8220;%d&#8221; pour le formatage.</p>
</div>
</div>
</div>
<div class="section" id="mbtiles-caches">
<span id="mapcache-cache-mbtiles"></span><h2>MBTiles caches<a class="headerlink" href="#mbtiles-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce type de cache est un raccourci vers la précédente version de schéma de cache SQlite personnalisée, avec des requêtes SQL pré-remplies correspondant aux spécifications MBTiles.</p>
<p>Bien que le schéma MBTiles par défaut soit très simple, MapCache utilise le même schéma multi-tables que l&#8217;on retrouve dans la plupart des fichiers MBTiles téléchargeables, principalement afin de permettre le stockage des tuiles vierges (uniformes) sans avoir à dupliquer les données (de la même manière que le cache disque utilise des liens symboliques vers un fichier unique)</p>
<p>Le schéma mbtiles est créé avec:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">create</span> <span class="k">table</span> <span class="n">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">images</span><span class="p">(</span>
  <span class="n">tile_id</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">tile_data</span> <span class="nb">blob</span><span class="p">,</span>
  <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_id</span><span class="p">));</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="k">map</span> <span class="p">(</span>
  <span class="n">zoom_level</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_column</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_row</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">tile_id</span> <span class="nb">text</span><span class="p">,</span>
  <span class="k">foreign</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">images</span><span class="p">(</span><span class="n">tile_id</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">tile_row</span><span class="p">,</span><span class="n">tile_column</span><span class="p">,</span><span class="n">zoom_level</span><span class="p">));</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">metadata</span><span class="p">(</span>
  <span class="n">name</span> <span class="nb">text</span><span class="p">,</span>
  <span class="n">value</span> <span class="nb">text</span><span class="p">);</span> <span class="c1">-- not used or populated yet</span>
<span class="k">create</span> <span class="k">view</span> <span class="n">if</span> <span class="k">not</span> <span class="k">exists</span> <span class="n">tiles</span>
  <span class="k">as</span> <span class="k">select</span>
     <span class="k">map</span><span class="p">.</span><span class="n">zoom_level</span> <span class="k">as</span> <span class="n">zoom_level</span><span class="p">,</span>
     <span class="k">map</span><span class="p">.</span><span class="n">tile_column</span> <span class="k">as</span> <span class="n">tile_column</span><span class="p">,</span>
     <span class="k">map</span><span class="p">.</span><span class="n">tile_row</span> <span class="k">as</span> <span class="n">tile_row</span><span class="p">,</span>
     <span class="n">images</span><span class="p">.</span><span class="n">tile_data</span> <span class="k">as</span> <span class="n">tile_data</span>
  <span class="k">from</span> <span class="k">map</span>
     <span class="k">join</span> <span class="n">images</span> <span class="k">on</span> <span class="n">images</span><span class="p">.</span><span class="n">tile_id</span> <span class="o">=</span> <span class="k">map</span><span class="p">.</span><span class="n">tile_id</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mbtiles&quot;</span> <span class="na">type=</span><span class="s">&quot;mbtiles&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>/Users/XXX/Documents/MapBox/tiles/natural-earth-1.mbtiles<span class="nt">&lt;/dbfile&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Contrairement au schéma sqlite standard de mapcache, le fichier de base de données mbtiles ne gère qu&#8217;un seul tileset par cache. Le comportement si plusieurs tilesets sont associés au même cache mbtiles n&#8217;est pas définie, et produira certainement des résultats incorrects.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Lorsqu&#8217;on travail avec plusieurs processus (option -p) et des backends de cache sqlite, des erreurs peuvent apparaître sous forte charge lors de l&#8217;écriture vers la base de données sqlite (erreur : erreur de logique SQL ou base de données manquante (1)). Mettre à jour sqlite &gt;=3.7.15 semble corriger le problème.</p>
</div>
</div>
<div class="section" id="memcache-caches">
<span id="mapcache-cache-memcache"></span><h2>Caches Memcache<a class="headerlink" href="#memcache-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ce type de cache stocke les tuiles au sein d&#8217;un serveur memcached externe, fonctionnant soit sur la machine elle-même soit accessible via le réseau. Ce type de cache a l&#8217;avantage de bien gérer l&#8217;expiration des tuiles, de sorte que la taille du cache ne dépassera jamais ce qui a été configuré dans l&#8217;instance memcache.</p>
<p>L&#8217;utilisation de Memcache nécessite une version plutôt récente de la librairie apr-util. Veuillez noter que sous de très fortes charges (généralement uniquement atteignable via des outils de benchmarking en localhost), l&#8217;implémentation memcache d&#8217;apr-util peut tomber et se mettre à abandonner les connexions pendant quelques intervalles de temps avant de revenir à la normale.</p>
<p>Vous pouvez ajouter de multiple entrées &lt;server&gt;.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;memcache&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;server&gt;</span>
      <span class="nt">&lt;host&gt;</span>localhost<span class="nt">&lt;/host&gt;</span>
      <span class="nt">&lt;port&gt;</span>11211<span class="nt">&lt;/port&gt;</span>
   <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Les tuiles stockées au travers de memcache sont configurées pour expirer au bout d&#8217;une journée par défaut. Ce réglage peut être modifié au niveau du jeu de données en utilisant le mot-clé &lt;auto_expire&gt;.</p>
</div>
<p>To limit the memory used by blank tiles inside the memcache instance, you
may enable blank tile detection, in which case a <cite>#rgba</cite> quadruplet will
be stored to the cache instead of the actual image data. MapCache will convert
that on the fly to a 1-bit paletted PNG image before returning it to the client.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;memcache&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;detect_blank/&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="geo-tiff-caches">
<span id="mapcache-cache-tiff"></span><h2>Caches (Geo)TIFF<a class="headerlink" href="#geo-tiff-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les caches TIFF sont le plus récent ajout à la famille des caches. Ils utilisent la structure interne tuilée de la spécification TIFF pour accéder aux données tuilées. Les tuiles ne peuvent être stockées qu&#8217;en JPEG (TIFF n&#8217;implémente pas le format PNG).</p>
<p>Comme un fichier TIFF unique peut contenir beaucoup de tuiles, il y a une réduction drastique du nombre de fichiers qui doivent être stockés sur le système de fichiers, ce qui résoud les principaux défauts des caches disques. Un autre avantage est que les mêmes fichiers TIFF peuvent être utilisés par des logiciels ou des serveurs WMS qui n&#8217;accèdent qu&#8217;à des formats SIG raster courants tout en étant utilisés pour un accès tuilé hautes performances.</p>
<p>Le cache TIFF doit être considéré comme étant en lecture-seule pour le moment. L&#8217;accès en écriture est déjà possible mais doit être considéré comme expérimental en cela qu&#8217;il peut y avoir des problèmes de corruption de fichier, surtout dans le contexte de montages réseaux du système de fichiers. Veuillez noter que jusqu&#8217;à ce que toutes les tuiles d&#8217;un fichier TIFF donné aient été générées, le fichier TIFF est réputé &#8220;clairsemé&#8221; au sens qu&#8217;il manque des tuiles. La plupart des logiciels autres que GDAL auront des difficultés à ouvrir ces fichiers incomplets.</p>
<p>Veuillez noter que la structure des tuiles TIFF doit respecter exactement la structure de la grille devant être utilisée par le jeu de tuile, et les noms des fichiers TIFF doivent respecter de strictes conventions de nommage.</p>
<div class="section" id="defining-the-tiff-file-sizes">
<h3>Définir les tailles de fichier TIFF<a class="headerlink" href="#defining-the-tiff-file-sizes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le nombre de tuiles stockées chacune des directions horizontales et verticales doit être défini:</p>
<ul class="simple">
<li><p class="first">&lt;xcount&gt; le nombre de tuiles stocké le long de la direction x (horizontal) du fichier TIFF.</p>
</li>
<li><p class="first">&lt;ycount&gt; le nombre de tuiles stocké le long de la direction y (horizontal) du fichier TIFF.</p>
</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;xcount&gt;</span>64<span class="nt">&lt;/xcount&gt;</span>
   <span class="nt">&lt;ycount&gt;</span>64<span class="nt">&lt;/ycount&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-file-naming-convention">
<h3>Configurer la convention de nommage fichier<a class="headerlink" href="#setting-up-the-file-naming-convention" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le tag &lt;template&gt; détermine le modèle à utiliser lors de la recherche d&#8217;un fichier TIFF en fonction des x,y,z de la tuile demandée</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;template&gt;</span>/data/tiffs/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.tif<span class="nt">&lt;/template&gt;</span>
   ...
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Les paramètres suivants sont disponibles pour manipuler les x,y et z d&#8217;une tuile donnée</p>
<ul class="simple">
<li><p class="first">{x} est remplacé par la valeur x de la tuile la plus à gauche dans le fichier TIFF contenant la tuile demandée</p>
</li>
<li><p class="first">{inv_x} est remplacé par la valeur x de la tuile la plus à droite</p>
</li>
<li><p class="first">{y} est remplacé par la valeur y de la tuile la plus en bas</p>
</li>
<li><p class="first">{inv_y} est remplacé par la valeur y de la tuile la plus en haut</p>
</li>
<li>{div_x} is replaced by the index of the TIFF file starting from the left
of the grid (i.e. {div_x} = {x}/&lt;xcount&gt;)</li>
<li><p class="first">{inv_div_x} comme {div_x} mais en commençant à droite.</p>
</li>
<li>{div_y} is replaced by the index of the TIFF file starting from the bottom
of the grid (i.e. {div_y} = {y}/&lt;ycount&gt;)</li>
<li><p class="first">{inv_div_y} est similaire {div_y} mais en commençant par le haut.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">{inv_x} et {inv_div_x} seront probablement rarement utilisés, tandix que {inv_y} et {inv_div_y} trouveront un usage approprié pour les personnes préférant indexer leurs fichiers TIFF de haut en bas plutôt que de bas en haut.</p>
</div>
</div>
<div class="section" id="customizing-the-template-keys">
<h3>Customiser les clés du &#8220;template&#8221;<a class="headerlink" href="#customizing-the-template-keys" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans certains cas, il peut être souhaitable d&#8217;avoir un contrôle précis sur le nom du fichier à utiliser pour une tuile x,y,z particulière, par exemple pour retrouver un fichier nommé &#8220;Z03-R00003-C000009.tif&#8221; plutôt que &#8220;Z3-R3-C9.tif&#8221;. Le paramètre &lt;template&gt; permet d&#8217;utiliser des éléments de formatage pour peu qu&#8217;ils suivent la syntaxe unix printf ( c.f.: <a class="reference external" href="http://linux.die.net/man/3/printf">http://linux.die.net/man/3/printf</a> ), en suffixant chacun des éléments &lt;template&gt; avec &#8220;_fmt&#8221; comme par exemple :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;template</span>
      <span class="na">x_fmt=</span><span class="s">&quot;%08d&quot;</span>
      <span class="na">inv_y_fmt=</span><span class="s">&quot;%08d&quot;</span>
   <span class="nt">&gt;</span>/data/tiffs/{tileset}/{grid}/L{z}/R{inv_y}/C{x}.tif<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sans indication, le fonctionnement par défaut utilise &#8220;%d&#8221; pour le formatage.</p>
</div>
</div>
<div class="section" id="setting-jpeg-compression-options">
<h3>Définir les options de compression JPEG<a class="headerlink" href="#setting-jpeg-compression-options" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un paramètre optionnel complémentaire définit la compression JPEG à appliquer aux tuiles quand elles sont enregistrées dans le fichier TIFF:</p>
<ul class="simple">
<li><p class="first">&lt;format&gt; le nom du format (jpeg) à utiliser</p>
</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last"><a class="reference internal" href="formats.html#mapcache-jpeg-format"><span>Format JPEG</span></a></p>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;format&gt;</span>myjpeg<span class="nt">&lt;/format&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Dans cet exemple, en utilisant une grille de 256x256 tuiles, les fichiers qui sont lus pour charger les tuiles sont des TIFFs tuilés avec une compression JPEG, dont la taille est de 16384x16384. Le nombre de fichiers à stocker sur le disque est ainsi réduit 4096 fois comparativement à un cache disque standard.</p>
</div>
<div class="section" id="using-a-specific-locker">
<h3>Using a specific locker<a class="headerlink" href="#using-a-specific-locker" title="Lien permanent vers ce titre">¶</a></h3>
<p>Mapcache needs to create a <a class="reference internal" href="locks.html#mapcache-locks"><span>lock</span></a> when writing inside a
TIFF file to ensure that no two instances are updating the same file
concurrently. By default the global mapcache locker will be used, you can
however configure a different locking mechanism or behavior by configuring it
inside the TIFF cache itself.</p>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last"><a class="reference internal" href="locks.html#mapcache-locks"><span>Locking Mechanisms</span></a></p>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tiff&quot;</span> <span class="na">type=</span><span class="s">&quot;tiff&quot;</span><span class="nt">&gt;</span>
   ...
   <span class="nt">&lt;locker&gt;</span> .... <span class="nt">&lt;/locker&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="geotiff-support">
<h3>Support GeoTIFF<a class="headerlink" href="#geotiff-support" title="Lien permanent vers ce titre">¶</a></h3>
<p>S&#8217;il est compilé avec le support GeoTiff en écriture, MapCache ajoutera les informations de référencement aux fichiers TIFF qu&#8217;il créé, de sorte que les fichiers TIFF puissent être utilisés par n&#8217;importe quel logiciel utilisant du geotiff. Le support en écriture ne produit pas des geotiffs complets avec la définition de la projection utilisée, mais uniquement l&#8217;échelle du pixel et les points de calage, ce qu&#8217;on trouve généralement dans les fichiers .tfw.</p>
<p>Pour référence, voici la sortie produite par gdalinfo sur une fichier TIFF créé par MapCache quand il est compilé avec le support geotiff:</p>
<div class="highlight-python"><div class="highlight"><pre>LOCAL_CS[&quot;unnamed&quot;,
    UNIT[&quot;metre&quot;,1,
        AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]]]
Origin = (-20037508.342789247632027,20037508.342789247632027)
Pixel Size = (156543.033928040997125,-156543.033928040997125)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  COMPRESSION=YCbCr JPEG
  INTERLEAVE=PIXEL
  SOURCE_COLOR_SPACE=YCbCr
Corner Coordinates:
Upper Left  (-20037508.343,20037508.343)
Lower Left  (-20037508.343,-20037508.343)
Upper Right (20037508.343,20037508.343)
Lower Right (20037508.343,-20037508.343)
Center      (   0.0000000,   0.0000000)
</pre></div>
</div>
</div>
</div>
<div class="section" id="rest-caches">
<span id="mapcache-cache-rest"></span><h2>REST Caches<a class="headerlink" href="#rest-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>The following cache types store and retrieve tiles through standard HTTP GET
and PUT operations, and can be used to store tiles in popular cloud storage
providers.</p>
<div class="section" id="pure-rest-cache">
<h3>Pure REST Cache<a class="headerlink" href="#pure-rest-cache" title="Lien permanent vers ce titre">¶</a></h3>
<p>This cache type can be used to store tiles to a webdav enabled server. You
must provide a template URL that should be used when accessing a tile with
a given x,y,z, etc...</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myrestcache&quot;</span> <span class="na">type=</span><span class="s">&quot;rest&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://myserver/webdav/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-specific-http-headers">
<h3>Specifying specific HTTP headers<a class="headerlink" href="#specifying-specific-http-headers" title="Lien permanent vers ce titre">¶</a></h3>
<p>You can customize which headers get added to the HTTP request, either
globally for every HTTP request, or specifically for a given type of request
(i.e. when getting, setting or deleting a tile):</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myrestcache&quot;</span> <span class="na">type=</span><span class="s">&quot;rest&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://myserver/webdav/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>my-virtualhost-alias.domain.com<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-put-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-put-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-get-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-get-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-head-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-head-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;delete&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;X-my-specific-delete-header&gt;</span>foo<span class="nt">&lt;/X-my-specific-delete-header&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="amazon-s3-rest-caches">
<span id="mapcache-cache-rest-s3"></span><h3>Amazon S3 REST Caches<a class="headerlink" href="#amazon-s3-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>The REST cache has been specialized to enable access to Amazon S3, in order
to add the layer of authentication/authorization needed for that platform.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;s3&quot;</span> <span class="na">type=</span><span class="s">&quot;s3&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://foo.s3.amazonaws.com/tiles/{tileset}/{grid}/{z}/{x}/{y}/{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>foo.s3.amazonaws.com<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;id&gt;</span>AKIE3SDEIT6TUG8DXEQI<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;secret&gt;</span>5F+dGsTfsdfkjdsfSDdasf4555d/sSff56sd/RDS<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;region&gt;</span>eu-west-1<span class="nt">&lt;/region&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;x-amz-storage-class&gt;</span>REDUCED_REDUNDANCY<span class="nt">&lt;/x-amz-storage-class&gt;</span>
      <span class="nt">&lt;x-amz-acl&gt;</span>public-read<span class="nt">&lt;/x-amz-acl&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>The &lt;id&gt; &lt;secret&gt; and &lt;region&gt; tags are required and are obtained and configured
through your amazon management console. You should read the documentation as to
what headers you want to be adding to your requests depending on your usecase (the
supplied example hosts tiles on cheaper storage, and allows them to be publicly
accessible).</p>
</div>
<div class="section" id="microsoft-azure-rest-caches">
<span id="mapcache-cache-rest-azure"></span><h3>Microsoft Azure REST Caches<a class="headerlink" href="#microsoft-azure-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>The REST cache has been specialized to enable access to Azure storage, in order
to add the layer of authentication/authorization needed for that platform.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;azure&quot;</span> <span class="na">type=</span><span class="s">&quot;azure&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://foo.blob.core.windows.net/tiles/{tileset}/{grid}/{z}/{x}/{y}/{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;headers&gt;</span>
    <span class="nt">&lt;Host&gt;</span>foo.blob.core.windows.net<span class="nt">&lt;/Host&gt;</span>
  <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;id&gt;</span>foo<span class="nt">&lt;/id&gt;</span>
  <span class="nt">&lt;secret&gt;</span>foobarcccccccccccccccccccccyA==<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;container&gt;</span>tiles<span class="nt">&lt;/container&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>The &lt;id&gt; &lt;secret&gt; and &lt;container&gt; tags are required and are obtained and configured
through your management console. You should read the documentation as to
what headers you want to be adding to your requests depending on your usecase.</p>
</div>
<div class="section" id="google-cloud-storage-rest-caches">
<span id="mapcache-cache-rest-google"></span><h3>Google Cloud Storage REST Caches<a class="headerlink" href="#google-cloud-storage-rest-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>The REST cache has been specialized to enable access to Google cloud storage, in order
to add the layer of authentication/authorization needed for that platform.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;google&quot;</span> <span class="na">type=</span><span class="s">&quot;google&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>https://storage.googleapis.com/mytiles-mapcache/{tileset}/{grid}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;access&gt;</span>GOOGPGDWFDG345SDFGSD<span class="nt">&lt;/access&gt;</span>
  <span class="nt">&lt;secret&gt;</span>sdfgsdSDFwedfwefr2345324dfsGdsfgs<span class="nt">&lt;/secret&gt;</span>
  <span class="nt">&lt;operation</span> <span class="na">type=</span><span class="s">&quot;put&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;headers&gt;</span>
      <span class="nt">&lt;x-amz-acl&gt;</span>public-read<span class="nt">&lt;/x-amz-acl&gt;</span>
    <span class="nt">&lt;/headers&gt;</span>
  <span class="nt">&lt;/operation&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>The &lt;access&gt; and &lt;secret&gt; tags are required and are obtained and configured
through your management console. You should read the documentation as to
what headers you want to be adding to your requests depending on your usecase.
Note that support for Google cloud storage uses its Amazon compatibility layer.</p>
</div>
</div>
<div class="section" id="meta-caches">
<span id="mapcache-cache-meta"></span><h2>Meta Caches<a class="headerlink" href="#meta-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>These cache types do not store tiles themselves, however they delegate the
storage of a tile to a number of child caches based on a set of rules or
behaviors. These caches are mostly usefull for large mapcache deployments
across multiple instances, with shared cache backends (i.e. dedicated memcache
servers, and network mounted filer filesystems).</p>
<div class="section" id="composite-caches">
<span id="mapcache-cache-composite"></span><h3>Composite Caches<a class="headerlink" href="#composite-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>This cache uses different child caches depending on the tile&#8217;s zoom level, and
can be used for example to store low zoom-level tiles to permanent storage, and
higher zoom-level to a temporary (i.e. memcache) cache.</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;cache name=&quot;mydisk&quot; ...&gt; ... &lt;/cache&gt;
&lt;cache name=&quot;mymemcache&quot; ...&gt; ... &lt;/cache&gt;
&lt;cache name=&quot;composite&quot; type=&quot;composite&quot;&gt;
   &lt;cache grids=&quot;mygrid,g&quot;&gt;mycache&lt;/cache&gt;
   &lt;cache min-zoom=&quot;0&quot; max-zoom=&quot;8&quot;&gt;mydisk&lt;/cache&gt;
   &lt;cache min-zoom=&quot;9&quot;&gt;mymemcache&lt;/cache&gt;
&lt;/cache&gt;
&lt;tileset ...&gt;
   &lt;cache&gt;composite&lt;/cache&gt;
   ...
&lt;/tileset&gt;
</pre></div>
</div>
<p>For each tile, the caches are tested in the order in which they have been
defined in the configuration file, and the first one to satisfy the min/max
zoom and grids constraints is used. It&#8217;s up to the user to make sure the
succession of min/max zoom values and grids makes sense, e.g.:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;composite&quot;</span> <span class="na">type=</span><span class="s">&quot;composite&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">min-zoom=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>cache1<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">min-zoom=</span><span class="s">&quot;9&quot;</span><span class="nt">&gt;</span>this_cache_will_never_be_used<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="fallback-caches">
<span id="mapcache-cache-fallback"></span><h3>Fallback Caches<a class="headerlink" href="#fallback-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>These cache types will return tiles from the first configured subcache that does
not return an error. They can be used when one of the caches is prone to error
conditions (e.g. remote rest caches, memcache)</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;fallback&quot;</span> <span class="na">type=</span><span class="s">&quot;fallback&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mymemcache<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mysqlitecache<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>When writing a tile to such a cache, it will be written to all the child caches.</p>
</div>
<div class="section" id="multitier-caches">
<span id="mapcache-cache-multitier"></span><h3>Multitier Caches<a class="headerlink" href="#multitier-caches" title="Lien permanent vers ce titre">¶</a></h3>
<p>These cache types can be used to combine fast/expensive caches with slow/cheap ones.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;multitier&quot;</span> <span class="na">type=</span><span class="s">&quot;multitier&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>cheap<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>If a given tile isn&#8217;t found in the first child cache, it will be read from the second
child cache <strong>and</strong> copied into the first child cache for subsequent accesses. This cache
type is meant to be used when the first cache does automatic pruning of the least recently
used tiles (i.e. a memcache one).</p>
<p>When writing a tile to such a cache, it will be written to the last child.</p>
</div>
<div class="section" id="cache-combinations">
<h3>Cache Combinations<a class="headerlink" href="#cache-combinations" title="Lien permanent vers ce titre">¶</a></h3>
<p>All these meta caches can be combined together to fine tune the availability and
performance depending on storage costs, time to recreate missing tiles, etc...</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;slow_and_permanent&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;fast_and_transient&quot;</span> <span class="na">type=</span><span class="s">&quot;memcache&quot;</span><span class="nt">&gt;</span>...<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;low_zooms&quot;</span> <span class="na">type=</span><span class="s">&quot;multitier&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast_and_transient<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>slow_and_permanent<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;mycache&quot;</span> <span class="na">type=</span><span class="s">&quot;composite&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;cache</span> <span class="na">maxzoom=</span><span class="s">&quot;12&quot;</span><span class="nt">&gt;</span>low_zooms<span class="nt">&lt;/cache&gt;</span>
   <span class="nt">&lt;cache&gt;</span>fast_and_transient<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;cache&gt;</span>
<span class="nt">&lt;tileset&gt;</span>
   <span class="nt">&lt;cache&gt;</span>mycache<span class="nt">&lt;/cache&gt;</span>
   ...
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
<p>In the previous example, all tiles are primarily accessed from a memcache instance, however
the lower zoom level tiles are backed up to a permanent sqlite cache which will be used to
populate the fast memcache cache e.g. on restarts.</p>
</div>
</div>
<div class="section" id="riak-caches">
<span id="mapcache-cache-riak"></span><h2>Riak Caches<a class="headerlink" href="#riak-caches" title="Lien permanent vers ce titre">¶</a></h2>
<p>requires <a class="reference external" href="https://github.com/trifork/riack">https://github.com/trifork/riack</a></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;myriak&quot;</span> <span class="na">type=</span><span class="s">&quot;riak&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;server&gt;</span>
    <span class="nt">&lt;host&gt;</span>riakhost<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;port&gt;</span>12345<span class="nt">&lt;/port&gt;</span>
    <span class="nt">&lt;bucket&gt;</span>mytiles<span class="nt">&lt;/bucket&gt;</span>
  <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Types de cache</a><ul>
<li><a class="reference internal" href="#disk-caches">Caches disque</a><ul>
<li><a class="reference internal" href="#common-configuration">Common Configuration</a></li>
<li><a class="reference internal" href="#default-structure">Structure par défaut</a></li>
<li><a class="reference internal" href="#arcgis-compatible-structure">Arcgis Compatible Structure</a></li>
<li><a class="reference internal" href="#worldwind-compatible-structure">Worldwind Compatible Structure</a></li>
<li><a class="reference internal" href="#template-structure">Structure du &#8220;template&#8221;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#berkeleydb-caches">Caches BerkeleyDB</a></li>
<li><a class="reference internal" href="#sqlite-caches">Caches Sqlite</a><ul>
<li><a class="reference internal" href="#default-schema">Schéma par défaut</a></li>
<li><a class="reference internal" href="#custom-schema">Schéma customisé</a></li>
<li><a class="reference internal" href="#blank-tile-detection">Blank Tile Detection</a></li>
<li><a class="reference internal" href="#using-multiple-sqlite-database-files">Using multiple sqlite database files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mbtiles-caches">MBTiles caches</a></li>
<li><a class="reference internal" href="#memcache-caches">Caches Memcache</a></li>
<li><a class="reference internal" href="#geo-tiff-caches">Caches (Geo)TIFF</a><ul>
<li><a class="reference internal" href="#defining-the-tiff-file-sizes">Définir les tailles de fichier TIFF</a></li>
<li><a class="reference internal" href="#setting-up-the-file-naming-convention">Configurer la convention de nommage fichier</a></li>
<li><a class="reference internal" href="#customizing-the-template-keys">Customiser les clés du &#8220;template&#8221;</a></li>
<li><a class="reference internal" href="#setting-jpeg-compression-options">Définir les options de compression JPEG</a></li>
<li><a class="reference internal" href="#using-a-specific-locker">Using a specific locker</a></li>
<li><a class="reference internal" href="#geotiff-support">Support GeoTIFF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rest-caches">REST Caches</a><ul>
<li><a class="reference internal" href="#pure-rest-cache">Pure REST Cache</a></li>
<li><a class="reference internal" href="#specifying-specific-http-headers">Specifying specific HTTP headers</a></li>
<li><a class="reference internal" href="#amazon-s3-rest-caches">Amazon S3 REST Caches</a></li>
<li><a class="reference internal" href="#microsoft-azure-rest-caches">Microsoft Azure REST Caches</a></li>
<li><a class="reference internal" href="#google-cloud-storage-rest-caches">Google Cloud Storage REST Caches</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meta-caches">Meta Caches</a><ul>
<li><a class="reference internal" href="#composite-caches">Composite Caches</a></li>
<li><a class="reference internal" href="#fallback-caches">Fallback Caches</a></li>
<li><a class="reference internal" href="#multitier-caches">Multitier Caches</a></li>
<li><a class="reference internal" href="#cache-combinations">Cache Combinations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#riak-caches">Riak Caches</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Regents of the University of Minnesota.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>