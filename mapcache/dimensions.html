<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tileset Dimensions &#8212; MapServer 7.0.7 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '7.0.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="MapServer 7.0.7 documentation" href="../index.html" />
    <link rel="up" title="MapCache 1.6.1" href="index.html" />
    <link rel="next" title="HTTP Requests" href="http.html" />
    <link rel="prev" title="Image Formats" href="formats.html" /> 
  </head>
  <body role="document">

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../community/service_providers.html" title="Professional Service Providers">Service Providers</a> |      
      <a href="../faq.html" title="Frequently Asked Questions">FAQ</a> |
      <a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a> |
      <a href="../download.html" title="Download Source or Binaries">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        <img src="../_static/flagicons/en.png" alt="en" title="en" border="0" width="18px" height="13px"/>
        
          <a href="../ar/mapcache/dimensions.html"><img src="../_static/flagicons/ar.png" alt="ar" title="ar" border="0" /></a>
        
        
          <a href="../de/mapcache/dimensions.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
        
        
          <a href="../el/mapcache/dimensions.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
        
        
          <a href="../es/mapcache/dimensions.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
        
        
          <a href="../fr/mapcache/dimensions.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
        
        
          <a href="../id/mapcache/dimensions.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
        
        
          <a href="../it/mapcache/dimensions.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
        
        
          <a href="../ja/mapcache/dimensions.html"><img src="../_static/flagicons/ja.png" alt="ja" title="ja" border="0" /></a>
        
        
          <a href="../nl_NL/mapcache/dimensions.html"><img src="../_static/flagicons/nl_NL.png" alt="nl_NL" title="nl_NL" border="0" /></a>
        
        
          <a href="../pl/mapcache/dimensions.html"><img src="../_static/flagicons/pl.png" alt="pl" title="pl" border="0" /></a>
        
        
          <a href="../ru/mapcache/dimensions.html"><img src="../_static/flagicons/ru.png" alt="ru" title="ru" border="0" /></a>
        
        
          <a href="../sq/mapcache/dimensions.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
        
        
          <a href="../tr/mapcache/dimensions.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
        

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Image Formats"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.0.7 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tileset-dimensions">
<span id="mapcache-dimensions"></span><h1>Tileset Dimensions<a class="headerlink" href="#tileset-dimensions" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Seth Girvin</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">sgirvin at compass.ie</td>
</tr>
<tr class="field-odd field"><th class="field-name">Last Updated:</th><td class="field-body">2018/05/04</td>
</tr>
</tbody>
</table>
<p>WMS layers in MapServer can support dimensions see <a class="reference internal" href="../ogc/wms_dimension.html#wms-dimension"><span class="std std-ref">WMS Dimension</span></a> for details.
MapCache also supports dimensions for tilesets.</p>
<p>Storing separate tile caches for different dimensions has several practical use cases such as creating caches for different
spatial boundaries, elevations, or time periods. It also provides a mechanism for dynamically switching Mapfiles based on a dimension value.</p>
<div class="section" id="dimension-types">
<h2>Dimension Types<a class="headerlink" href="#dimension-types" title="Permalink to this headline">¶</a></h2>
<p>Several types of dimensions are supported by MapCache. These are added within a <code class="docutils literal"><span class="pre">&lt;tileset&gt;</span></code> configuration.</p>
<div class="section" id="values-dimensions">
<h3>Values Dimensions<a class="headerlink" href="#values-dimensions" title="Permalink to this headline">¶</a></h3>
<p>A Values type dimension lists all possible dimension values. The name of the dimension is used as the key in a query string when accessing
through a WMS or WMTS service, for example <code class="docutils literal"><span class="pre">&amp;DIM1=foobarbaz</span></code>. Any dimensions specified for a tileset will be forwarded on to their WMS source.</p>
<p>If a client does not provide the dimension as a key value pair the default will be used (in this example <code class="docutils literal"><span class="pre">foobar</span></code>).</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tileset</span> <span class="na">name=</span><span class="s">&quot;LayerName&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source&gt;</span>LayerSource<span class="nt">&lt;/source&gt;</span>
    <span class="nt">&lt;cache&gt;</span>sqlite<span class="nt">&lt;/cache&gt;</span>
    <span class="nt">&lt;grid&gt;</span>GoogleMapsCompatible<span class="nt">&lt;/grid&gt;</span>
    <span class="nt">&lt;format&gt;</span>PNG<span class="nt">&lt;/format&gt;</span>
    <span class="nt">&lt;metatile&gt;</span>5 5<span class="nt">&lt;/metatile&gt;</span>
    <span class="nt">&lt;metabuffer&gt;</span>10<span class="nt">&lt;/metabuffer&gt;</span>
    <span class="nt">&lt;dimensions&gt;</span>
        <span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;values&quot;</span> <span class="na">name=</span><span class="s">&quot;DIM1&quot;</span> <span class="na">default=</span><span class="s">&quot;foobar&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobar<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foobarbaz<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>foo<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>bar<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/dimension&gt;</span>
    <span class="nt">&lt;/dimensions&gt;</span>
<span class="nt">&lt;/tileset&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="regex-dimensions">
<h3>Regex Dimensions<a class="headerlink" href="#regex-dimensions" title="Permalink to this headline">¶</a></h3>
<p>An alternative to the hard-coded list of values is to use regular expressions.</p>
<p>The following example creates a MAPFILE dimension, for using the same MapCache tileset with different MapServer
Mapfiles. The name of the Mapfiles need not be known to MapCache, and can therefore be created even after MapCache has been started.</p>
<p>When a user passes a <code class="docutils literal"><span class="pre">MAPFILE=/path/to/mapfile</span></code>, the string <code class="docutils literal"><span class="pre">/path/to/mapfile</span></code> is validated against
the supplied (PCRE) regular expression. The one in this example allows a name composed of alphanumeric characters
separated by slashes (/) and finishing with &#8221;.map&#8221; ( [a-zA-Z0-9./]*.map$ ) , but will fail if there
are two consecutive dots (..) in the path, to prevent file-system traversal.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;regex&quot;</span> <span class="na">name=</span><span class="s">&quot;MAPFILE&quot;</span> <span class="na">default=</span><span class="s">&quot;/path/to/mapfile.map&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;regex&gt;</span>^(?!.*\.\.)[a-zA-Z0-9\./]*\.map$<span class="nt">&lt;/regex&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="time-dimensions">
<h3>Time Dimensions<a class="headerlink" href="#time-dimensions" title="Permalink to this headline">¶</a></h3>
<p>MapCache supports WMTS and WMS requests that include a TIME parameter, for both timestamps and time intervals.
See <a class="reference internal" href="../development/rfc/ms-rfc-96.html#rfc96"><span class="std std-ref">MS RFC 96: Time Dimension Support in MapCache Tilesets</span></a> for further details.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dimension</span> <span class="na">type=</span><span class="s">&quot;time&quot;</span> <span class="na">name=</span><span class="s">&quot;MAPFILE&quot;</span> <span class="na">default=</span><span class="s">&quot;/path/to/mapfile.map&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dbfile&gt;</span>/path/to/mapcache-time.sqlite<span class="nt">&lt;/dbfile&gt;</span>
    <span class="nt">&lt;query&gt;</span>
        select
        strftime(&#39;%Y-%m-%dT%H:%M:%SZ&#39;,start_time)||&#39;/&#39;||strftime(&#39;%Y-%m-%dT%H:%M:%SZ&#39;,end_time)
        from
        time
        where
        source_id=:tileset
        and
        start_time<span class="ni">&amp;gt;</span>=datetime(:start_timestamp,&#39;unixepoch&#39;)
        and
        end_time<span class="ni">&amp;lt;</span>=datetime(:end_timestamp,&#39;unixepoch&#39;)
        order by
        end_time
    <span class="nt">&lt;/query&gt;</span>
<span class="nt">&lt;/dimension&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="assembly-dimensions">
<h3>Assembly Dimensions<a class="headerlink" href="#assembly-dimensions" title="Permalink to this headline">¶</a></h3>
<p>TODO</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>&lt;dimensions&gt;
    &lt;assembly_type&gt;stack&lt;/assembly_type&gt;
    &lt;dimension ...&gt;....&lt;/dimension&gt;
&lt;/dimensions&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="storing-dimensions">
<h2>Storing Dimensions<a class="headerlink" href="#storing-dimensions" title="Permalink to this headline">¶</a></h2>
<p>When using a disk based cache tiles will be stored in a folder structure similar to
<code class="docutils literal"><span class="pre">base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png</span></code> (where DIM1 is the dimension value).</p>
<p>The order of the <code class="docutils literal"><span class="pre">&lt;dimension&gt;</span></code> tags inside the <code class="docutils literal"><span class="pre">&lt;dimensions&gt;</span></code> tag  is important as it is used
to create the directory structure for the disk cache. If you change the order of these
values, any tiles that have been previously cached are invalidated (they will be unavailable to MapCache but not deleted).</p>
<p>Templates can be used to change the folder structure for example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;tmpl&quot;</span> <span class="na">type=</span><span class="s">&quot;disk&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template&gt;</span>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}<span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
<p>Templates can also be used to change Sqlite database names e.g.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- the following will create databases named TilesetName-#DimensionValue.db --&gt;</span>
<span class="nt">&lt;cache</span> <span class="na">name=</span><span class="s">&quot;sqlite&quot;</span> <span class="na">type=</span><span class="s">&quot;sqlite3&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dbfile&gt;</span>{tileset}-{dim}.db<span class="nt">&lt;/dbfile&gt;</span>
   <span class="nt">&lt;detect_blank</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/cache&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-tile-caches-with-dimensions">
<h2>Accessing Tile Caches with Dimensions<a class="headerlink" href="#accessing-tile-caches-with-dimensions" title="Permalink to this headline">¶</a></h2>
<p>To retrieve a tile with a specific dimension, add the dimension name and value to the request query string e.g. <code class="docutils literal"><span class="pre">&amp;DIM1=value</span></code></p>
<p>Only WMS and WMTS clients support passing dimensions to MapCache. Other tile services such as gmaps (GoogleMaps), tms, and KML
do not support dimensions. WMTS however does allow access using a x,y,z addressing scheme, so by using URL rewriting on the web server
tile-based clients (for example an OpenLayers <code class="docutils literal"><span class="pre">ol.source.XYZ</span></code> layer) can load a dimension-based tileset.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># a URL such as the following</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">tiles</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">3914</span><span class="o">/</span><span class="mf">2687.</span><span class="n">png</span>
<span class="c1"># can be rewritten into a WMTS request - note WMTS uses {z}/{y}/{x} rather than {z}/{x}/{y}</span>
<span class="c1"># so these values need to be swapped</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">servername</span><span class="o">/</span><span class="n">mapcache</span><span class="o">/</span><span class="n">wmts</span><span class="o">/</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">layername</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">dimension</span><span class="o">/</span><span class="n">GoogleMapsCompatible</span><span class="o">/</span><span class="mi">13</span><span class="o">/</span><span class="mi">2687</span><span class="o">/</span><span class="mf">3914.</span><span class="n">png</span>
</pre></div>
</div>
</div>
<div class="section" id="seeding-tile-caches-with-dimensions">
<h2>Seeding Tile Caches with Dimensions<a class="headerlink" href="#seeding-tile-caches-with-dimensions" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="seed.html#mapcache-seed"><span class="std std-ref">MapCache seeding tool</span></a> allows specific dimensions to be seeded with the following syntax:</p>
<div class="highlight-bat"><div class="highlight"><pre><span></span>mapcache_seed -c mapcache_config.xml -t tileset1 -e -1187000,6695000,-605000,7450000 -z 7,10 --dimension DIMENSION_NAME=DIMENSION_VALUE
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a><br>
<a href="../psc.html" title="PSC">PSC</a><br>
<a href="https://twitter.com/mapserver_osgeo" title="Twitter">Twitter</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tileset Dimensions</a><ul>
<li><a class="reference internal" href="#dimension-types">Dimension Types</a><ul>
<li><a class="reference internal" href="#values-dimensions">Values Dimensions</a></li>
<li><a class="reference internal" href="#regex-dimensions">Regex Dimensions</a></li>
<li><a class="reference internal" href="#time-dimensions">Time Dimensions</a></li>
<li><a class="reference internal" href="#assembly-dimensions">Assembly Dimensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storing-dimensions">Storing Dimensions</a></li>
<li><a class="reference internal" href="#accessing-tile-caches-with-dimensions">Accessing Tile Caches with Dimensions</a></li>
<li><a class="reference internal" href="#seeding-tile-caches-with-dimensions">Seeding Tile Caches with Dimensions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="http.html" title="HTTP Requests"
             >next</a> |</li>
        <li class="right" >
          <a href="formats.html" title="Image Formats"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../documentation.html" >MapServer 7.0.7 Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >MapCache 1.6.1</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../copyright.html">Copyright</a> 2018, Open Source Geospatial Foundation.
      Last updated on 2018-05-04.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.
    </div>
  </body>
</html>