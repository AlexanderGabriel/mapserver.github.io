

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="NOINDEX" name="ROBOTS" />

    <title>Compilation &amp; Installation &mdash; MapServer 6.4.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/mapserver.ico"/>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="copyright" title="版权所有" href="../copyright.html" />
    <link rel="top" title="MapServer 6.4.1 documentation" href="../index.html" /> 
  </head>
  <body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../index.html" title="Home"><img src="../_static/banner.png" alt="MapServer banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../index.html" title="Home">Home</a> |
      <a href="../products.html" title="Products (MapServer core, MapCache, TinyOWS">Products</a> |
      <a href="https://github.com/mapserver/mapserver/issues/" title="Issue Tracker (MapServer core)">Issue Tracker</a> |
      <a href="../faq.html" title="FAQ">FAQ</a> |
      <a href="../download.html" title="Download">Download </a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
        
          
            <a href="../../mapcache/install.html"><img src="../_static/flagicons/en.png" alt="en" title="en" border="0" /></a>
          
        
        
          
            <a href="../../it/mapcache/install.html"><img src="../_static/flagicons/it.png" alt="it" title="it" border="0" /></a>
          
        
        
          
            <a href="../../es/mapcache/install.html"><img src="../_static/flagicons/es.png" alt="es" title="es" border="0" /></a>
          
        
        <img src="../_static/flagicons/zh_cn.png" alt="zh_cn" title="zh_cn" border="0" width="18px" height="13px"/>
        
          
            <a href="../../de/mapcache/install.html"><img src="../_static/flagicons/de.png" alt="de" title="de" border="0" /></a>
          
        
        
          
            <a href="../../el/mapcache/install.html"><img src="../_static/flagicons/el.png" alt="el" title="el" border="0" /></a>
          
        
        
          
            <a href="../../fr/mapcache/install.html"><img src="../_static/flagicons/fr.png" alt="fr" title="fr" border="0" /></a>
          
        
        
          
            <a href="../../id/mapcache/install.html"><img src="../_static/flagicons/id.png" alt="id" title="id" border="0" /></a>
          
        
        
          
            <a href="../../sq/mapcache/install.html"><img src="../_static/flagicons/sq.png" alt="sq" title="sq" border="0" /></a>
          
        
        
          
            <a href="../../tr/mapcache/install.html"><img src="../_static/flagicons/tr.png" alt="tr" title="tr" border="0" /></a>
          
        

    </td>
  </tr>
</table>


    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li><a href="../index.html">Home</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="compilation-installation">
<span id="mapcache-install"></span><h1><a class="toc-backref" href="#table-of-contents">Compilation &amp; Installation</a><a class="headerlink" href="#compilation-installation" title="永久链接至标题">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Thomas Bonfort</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">tbonfort at terriscope.fr</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Alan Boudreault</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">aboudreaut at magears.com</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Jeff McKenna</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">jmckenna at gatewaygeomatics.com</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Mathieu Coudert</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body">mathieu.coudert at gmail.com</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#compilation-installation" id="id1">Compilation &amp; Installation</a><ul>
<li><a class="reference internal" href="#getting-the-source" id="id2">Getting the Source</a></li>
<li><a class="reference internal" href="#linux-instructions" id="id3">Linux Instructions</a><ul>
<li><a class="reference internal" href="#apache-module-specific-instructions" id="id4">Apache Module Specific Instructions</a></li>
<li><a class="reference internal" href="#nginx-specific-instructions" id="id5">Nginx Specific Instructions</a></li>
<li><a class="reference internal" href="#cgi-fastcgi-specific-instructions" id="id6">CGI/FastCGI Specific Instructions</a></li>
<li><a class="reference internal" href="#customizing-the-build-or-if-something-went-wrong" id="id7">Customizing the build, or if something went wrong</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows-instructions" id="id8">Windows Instructions</a><ul>
<li><a class="reference internal" href="#dependencies" id="id9">Dependencies</a></li>
<li><a class="reference internal" href="#configure-your-makefile" id="id10">Configure Your Makefile</a></li>
<li><a class="reference internal" href="#compilation" id="id11">Compilation</a></li>
<li><a class="reference internal" href="#move-the-module-into-apache-directory" id="id12">Move the Module into Apache Directory</a></li>
<li><a class="reference internal" href="#configure-your-installed-apache" id="id13">Configure Your Installed Apache</a></li>
<li><a class="reference internal" href="#test-your-mapcache-module" id="id14">Test Your MapCache Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="getting-the-source">
<h2><a class="toc-backref" href="#table-of-contents">Getting the Source</a><a class="headerlink" href="#getting-the-source" title="永久链接至标题">¶</a></h2>
<p>The MapCache project is located at <a class="reference external" href="https://github.com/mapserver/mapcache">https://github.com/mapserver/mapcache</a>, and can be checked out
with either:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># readonly</span>
git clone git://github.com/mapserver/mapcache.git
<span class="c"># ssh authenticated</span>
git clone git@github.com:mapserver/mapcache.git
<span class="c"># tarball</span>
wget https://github.com/mapserver/mapcache/zipball/master
</pre></div>
</div>
</div>
<div class="section" id="linux-instructions">
<h2><a class="toc-backref" href="#table-of-contents">Linux Instructions</a><a class="headerlink" href="#linux-instructions" title="永久链接至标题">¶</a></h2>
<p>These instructions target a debian/ubuntu setup, but should apply with few
modifications to any linux installation.</p>
<p>MapCache requires a number of library headers in order to compile correctly:</p>
<ul class="simple">
<li><strong>apache / apr / apr-util / apx2</strong>: these are included in the <em>apache2-prefork-dev</em> or
<em>apache2-threaded-dev</em> packages, depending on what apache mpm you are running.
This package will pull in the necessary apr headers, that you would have to
manually install if you are not buidling an apache module (<em>libaprutil1-dev</em>
and <em>libapr1-dev</em>)</li>
<li><strong>png</strong>: <em>libpng12-dev</em></li>
<li><strong>jpeg</strong>: <em>libjpeg62-dev</em></li>
<li><strong>curl</strong>: <em>libcurl4-gnutls-dev</em></li>
</ul>
<p>The following libraries are not required, but recommended:</p>
<ul class="simple">
<li><strong>pcre</strong>: <em>libpcre3-dev</em>. This will give you more powerfull regular expression
syntax when creating validation expressions for dimensions</li>
<li><strong>pixman</strong>: <em>libpixman-1-dev</em>. The pixel manipulation library is used for
scaling and alpha-compositing images. MapCache ships with some code to
perform these tasks, but pixman is generally faster as it includes
code optimized for modern cpus (sse2, mmx, etc...)</li>
</ul>
<p>The following libraries are not required, but needed to enable additional
functionalities:</p>
<ul class="simple">
<li><strong>fcgi</strong>: <em>libfcgi-dev</em>. Needed to build a fastcgi program if you don&#8217;t want to
run mapcache as an apache module.</li>
<li><strong>gdal / geos</strong>: <em>libgdal1-dev</em> <em>libgeos-dev</em>. Needed to enable advanced seeding
options (for only seeding tiles that intersect a given geographical feature)</li>
<li><strong>sqlite</strong>: <em>libsqlite3-dev</em>. For enabling the sqlite backend storages</li>
<li><strong>tiff</strong>: <em>libtiff4-dev</em>. For enabling the TIFF backend storages</li>
<li><strong>berkeley db</strong> <em>libdb4.8-dev</em> : For enabling the Berkeley DB backend storages</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">MapCache now builds with cmake.</p>
</div>
<p>For unix users where all packages are in the default locations, the compilation
process should resume to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>mapcache
<span class="nv">$ </span>mkdir build
<span class="nv">$ </span><span class="nb">cd </span>build
<span class="nv">$ </span>cmake ..
<span class="nv">$ </span><span class="c"># follow instructions below if missing a dependency</span>
<span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
</pre></div>
</div>
<div class="section" id="apache-module-specific-instructions">
<h3><a class="toc-backref" href="#table-of-contents">Apache Module Specific Instructions</a><a class="headerlink" href="#apache-module-specific-instructions" title="永久链接至标题">¶</a></h3>
<p>The make install above installs the apache module, but if you need to
specifically need to install only the apache module you can do the following</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo make install-module
<span class="nv">$ </span>sudo ldconfig
</pre></div>
</div>
<p>The installation script takes care of putting the built module in the apache
module directory.  The process for activating a module is usually distro
specific, but can be resumed by the following snippet that should be present in
the apache configuration file ( e.g. /usr/local/httpd/conf/httpd.conf or
/etc/apache2/sites-available/default ):</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">LoadModule</span> mapcache_module    modules/mod_mapcache.so
</pre></div>
</div>
<p>Next, a mapcache configuration is mapped to the server url with the following
snippet</p>
<p>For apache &lt; 2.4:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mapcache_module</span><span class="nt">&gt;</span>
   <span class="nt">&lt;Directory</span> <span class="s">/path/to/directory</span><span class="nt">&gt;</span>
      <span class="nb">Order</span> Allow,Deny
      <span class="nb">Allow</span> from <span class="k">all</span>
   <span class="nt">&lt;/Directory&gt;</span>
   <span class="nb">MapCacheAlias</span> <span class="sx">/mapcache</span> <span class="s2">&quot;/path/to/directory/mapcache.xml&quot;</span>
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>For apache &gt;= 2.4:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mapcache_module</span><span class="nt">&gt;</span>
   <span class="nt">&lt;Directory</span> <span class="s">/path/to/directory</span><span class="nt">&gt;</span>
      <span class="nb">Require</span> <span class="k">all</span> granted
   <span class="nt">&lt;/Directory&gt;</span>
   <span class="nb">MapCacheAlias</span> <span class="sx">/mapcache</span> <span class="s2">&quot;/path/to/directory/mapcache.xml&quot;</span>
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>Before you restart, copy the example mapcache.xml file to where you want it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cp mapcache.xml /path/to/directory/mapcache.xml
</pre></div>
</div>
<p>Finally, restart apache to take the modified configuration into account</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sudo apachectl restart
</pre></div>
</div>
<p>If you have not disabled the demo service, you should now have access to it on
<a class="reference external" href="http://myserver/mapcache/demo">http://myserver/mapcache/demo</a></p>
</div>
<div class="section" id="nginx-specific-instructions">
<h3><a class="toc-backref" href="#table-of-contents">Nginx Specific Instructions</a><a class="headerlink" href="#nginx-specific-instructions" title="永久链接至标题">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Working with nginx is still somewhat experimental. The following
workflow has only been tested on the development version, i.e.
nginx-1.1.x</p>
</div>
<p>For nginx support you need to build mapcache&#8217;s nginx module against the
nginx source. Download the nginx source code:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /usr/local/src
<span class="nv">$ </span>mkdir nginx
<span class="nv">$ </span><span class="nb">cd </span>nginx
<span class="nv">$ </span>wget http://nginx.org/download/nginx-1.1.19.tar.gz
<span class="nv">$ </span>tar -xzvf nginx-1.1.19.tar.gz
<span class="nv">$ </span><span class="nb">cd </span>nginx-1.1.19/
</pre></div>
</div>
<p>Run the configure command with the flag  <tt class="docutils literal"><span class="pre">--add-module</span></tt>. This flag
must point to mapcache&#8217;s nginx child directory. Assuming that
mapserver source was cloned or un tarred into to <tt class="docutils literal"><span class="pre">/usr/local/src</span></tt>,
an example configure command for nginx would look like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>./configure --add-module<span class="o">=</span>/usr/local/src/mapcache/nginx
</pre></div>
</div>
<p>Then build nginx:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>make
<span class="nv">$ </span>sudo make install
</pre></div>
</div>
<p>Due to nginx&#8217;s non-blocking architecture, the mapcache nginx module does not
perform any operations that may lead to a worker process being blocked by a
long computation (i.e.: requesting a (meta)tile to be rendered if not in the
cache, proxying a request to an upstream wms server, or waiting for a tile to
be rendered by another worker), it will instead issue a 404 error. This
behavior is essential so as not to occupy all nginx worker threads, therefore
preventing it from responding to all other incoming requests. While this isn&#8217;t
an issue for completely seeded tilesets, this implies that these kinds of
requests need to be proxied to another mapcache instance that does not suffer
from these starvation issues (i.e. either a fastcgi mapcache, or an internal
proxied apache server). In this scenario, both the nginx mapcache instance and
the apache/fastcgi mapcache instance should be running with the same
<tt class="docutils literal"><span class="pre">mapcache.xml</span></tt> configuration file.</p>
<p>Mapcache supplies a <tt class="docutils literal"><span class="pre">nginx.conf</span></tt> in its nginx child directory. The conf
contains an example configuration to load mapcache. The most relevant part of
the configuration is the location directive that points the  <tt class="docutils literal"><span class="pre">^/mapcache</span></tt> URI
to the <tt class="docutils literal"><span class="pre">mapcache.xml</span></tt> path. You will need to change this path to point to
your own <tt class="docutils literal"><span class="pre">mapcache.xml</span></tt>  in the mapcache source</p>
<p>The basic configuration without any proxying (which will return 404 errors on
unseeded tile requests) is:</p>
<div class="highlight-nginx"><div class="highlight"><pre><span class="k">location</span> <span class="p">~</span> <span class="sr">^/mapcache(?&lt;path_info&gt;/.*|$)</span> <span class="p">{</span>
   <span class="kn">set</span> <span class="nv">$url_prefix</span> <span class="s">&quot;/mapcache&quot;</span><span class="p">;</span>
   <span class="kn">mapcache</span> <span class="s">/usr/local/src/mapcache/mapcache.xml</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If proxying unseeded tile requests to a mapcache instance running on an apache
server, we will proxy all 404 mapcache errors to a <tt class="docutils literal"><span class="pre">mapcache.apache.tld</span></tt>
server listening on port 8080, configured to respond to mapcache requests on
the <tt class="docutils literal"><span class="pre">/mapcache</span></tt> location.</p>
<div class="highlight-nginx"><div class="highlight"><pre><span class="k">location</span> <span class="p">~</span> <span class="sr">^/mapcache(?&lt;path_info&gt;/.*|$)</span> <span class="p">{</span>
   <span class="kn">set</span> <span class="nv">$url_prefix</span> <span class="s">&quot;/mapcache&quot;</span><span class="p">;</span>
   <span class="kn">mapcache</span> <span class="s">/usr/local/src/mapcache/mapcache.xml</span><span class="p">;</span>
   <span class="kn">error_page</span> <span class="mi">404</span> <span class="p">=</span> <span class="s">@apache_mapcache</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="s">@apache_mapcache</span> <span class="p">{</span>
   <span class="kn">proxy_pass</span> <span class="s">http://mapcache.apache.tld:8080</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If using fastcgi instances of mapcache, spawned with e.g. spawn-fcgi or
supervisord on port 9001 (make sure to enable fastcgi when building mapcache,
and to set the MAPCACHE_CONFIG_FILE environment variable before spawning):</p>
<div class="highlight-nginx"><div class="highlight"><pre><span class="k">location</span> <span class="p">~</span> <span class="sr">^/mapcache(?&lt;path_info&gt;/.*|$)</span> <span class="p">{</span>
   <span class="kn">set</span> <span class="nv">$url_prefix</span> <span class="s">&quot;/mapcache&quot;</span><span class="p">;</span>
   <span class="kn">mapcache</span> <span class="s">/usr/local/src/mapcache/mapcache.xml</span><span class="p">;</span>
   <span class="kn">error_page</span> <span class="mi">404</span> <span class="p">=</span> <span class="s">@fastcgi_mapcache</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">location</span> <span class="s">@fastcgi_mapcache</span> <span class="p">{</span>
   <span class="kn">fastcgi_pass</span>   <span class="n">localhost</span><span class="p">:</span><span class="mi">9001</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">QUERY_STRING</span>     <span class="nv">$query_string</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">REQUEST_METHOD</span>   <span class="nv">$request_method</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">CONTENT_TYPE</span>     <span class="nv">$content_type</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">CONTENT_LENGTH</span>   <span class="nv">$content_length</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">PATH_INFO</span>        <span class="nv">$path_info</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">SERVER_NAME</span>      <span class="nv">$server_name</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">SERVER_PORT</span>      <span class="nv">$server_port</span><span class="p">;</span>
   <span class="kn">fastcgi_param</span>  <span class="s">SCRIPT_NAME</span>      <span class="s">&quot;/mapcache&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Copy the relevant sections of <tt class="docutils literal"><span class="pre">nginx.conf</span></tt> from mapcache&#8217;s <tt class="docutils literal"><span class="pre">nginx</span></tt>
directory into nginx&#8217;s conf file (in this case
<tt class="docutils literal"><span class="pre">/usr/local/nginx/conf/nginx.conf</span></tt>) , you should now have access to the demo
at <a class="reference external" href="http://myserver/mapcache/demo">http://myserver/mapcache/demo</a></p>
</div>
<div class="section" id="cgi-fastcgi-specific-instructions">
<h3><a class="toc-backref" href="#table-of-contents">CGI/FastCGI Specific Instructions</a><a class="headerlink" href="#cgi-fastcgi-specific-instructions" title="永久链接至标题">¶</a></h3>
<p>A binary cgi/fastcgi is located in the mapcache/ subfolder, and is named &#8220;mapcache&#8221;.
Activating fastcgi for the mapcache program on your web server is not part of
these instructions, more details may be found on the <a class="reference internal" href="../optimization/fastcgi.html#fastcgi"><em>FastCGI</em></a>
page or on more general web pages across the web.</p>
<p>The MapCache fastcgi program looks for it&#8217;s configuration file in the environment
variable called MAPCACHE_CONFIG_FILE, which must be set by the web server before
spawning the mapcache processes.</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">也可以参考</p>
<p class="last"><a class="reference internal" href="config.html#mapcache-config"><em>Configuration File</em></a></p>
</div>
<p>For apache with mod_cgi:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">SetEnv</span> <span class="s2">&quot;MAPCACHE_CONFIG_FILE&quot;</span> <span class="s2">&quot;/path/to/mapcache/mapcache.xml&quot;</span>
</pre></div>
</div>
<p>For apache with mod_fcgid:</p>
<div class="highlight-apache"><pre>FcgidInitialEnv "MAPCACHE_CONFIG_FILE" "/path/to/mapcache/mapcache.xml</pre>
</div>
<p>If you have not disabled the demo service, you should now have access to it on
<a class="reference external" href="http://myserver/fcgi-bin/mapcache/demo">http://myserver/fcgi-bin/mapcache/demo</a> supposing your fcgi processes are accessed
under the fcgi-bin alias.</p>
<p>With a working mod_fcgid apache instance, the full httpd.conf snippet to activate
mapcache could be:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mod_fcgid.c</span><span class="nt">&gt;</span>
   <span class="nb">IPCCommTimeout</span> <span class="m">120</span>
   <span class="nb">MaxProcessCount</span> <span class="m">10</span>
   <span class="nb">FcgidInitialEnv</span> <span class="s2">&quot;MAPCACHE_CONFIG_FILE&quot;</span> <span class="s2">&quot;/path/to/mapcache/mapcache.xml&quot;</span>
   <span class="nt">&lt;Location</span> <span class="s">/map.fcgi</span><span class="nt">&gt;</span>
      <span class="nb">Order</span> Allow,Deny
      <span class="nb">Allow</span> from <span class="k">all</span>
      <span class="nb">SetHandler</span> fcgid-script
   <span class="nt">&lt;/Location&gt;</span>
   <span class="nb">ScriptAlias</span> <span class="sx">/map.fcgi</span> <span class="s2">&quot;/path/to/mapcache/src/mapcache&quot;</span>
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
<p>The mapcache service would then be accessible at <a class="reference external" href="http://myserver/map.fcgi[/demo">http://myserver/map.fcgi[/demo</a>]</p>
</div>
<div class="section" id="customizing-the-build-or-if-something-went-wrong">
<h3><a class="toc-backref" href="#table-of-contents">Customizing the build, or if something went wrong</a><a class="headerlink" href="#customizing-the-build-or-if-something-went-wrong" title="永久链接至标题">¶</a></h3>
<p>Depending on what packages are available in the default locations of your system,
the &#8220;cmake ..&#8221; step will most probably have failed with messages indicating
missing dependencies (by default, MapCache has <em>some</em> of those). The error message
that CMake prints out should give you a rather good idea of what steps you should take
next, depending on wether the failed dependency is a feature you require in your build
or not.</p>
<p>mod_mapcache requires apache, libcurl, libjpeg and libpng development headers.
The cmake script will try to locate them in default system locations, that can be
overriden or specified with -D switches. For example, if you get a message such as
&#8216;Could NOT find APR &#8216;, you can use a command such as
(assuming that apr is at /usr/local/apr) :</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cmake -DCMAKE_PREFIX_PATH<span class="o">=</span><span class="s2">&quot;/usr/local/apr;&quot;</span> ..
</pre></div>
</div>
<p>Either if you don&#8217;t want fcgi you can disable the dependency by rerunning cmake with -DWITH_DEPENDENCY=0, e.g.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cmake .. -DWITH_FCGI<span class="o">=</span>0
</pre></div>
</div>
<div class="section" id="options-supported-by-the-mapcache-cmake-builder">
<h4>Options supported by the MapCache cmake builder<a class="headerlink" href="#options-supported-by-the-mapcache-cmake-builder" title="永久链接至标题">¶</a></h4>
<p>Here is a list of supported options that can be enabled/disabled at build.</p>
<blockquote>
<div><div class="highlight-python"><pre>option(WITH_PIXMAN "Use pixman for SSE optimized image manipulations" ON)
option(WITH_SQLITE "Use sqlite as a cache backend" ON)
option(WITH_BERKELEY_DB "Use Berkeley DB as a cache backend" OFF)
option(WITH_MEMCACHE "Use memcache as a cache backend (requires recent apr-util)" OFF)
option(WITH_TIFF "Use TIFFs as a cache backend" OFF)
option(WITH_TIFF_WRITE_SUPPORT "Enable (experimental) support for writable TIFF cache backends" OFF)
option(WITH_GEOTIFF "Allow GeoTIFF metadata creation for TIFF cache backends" OFF)
option(WITH_PCRE "Use PCRE for regex tests" OFF)
option(WITH_MAPSERVER "Enable (experimental) support for the mapserver library" OFF)
option(WITH_GEOS "Choose if GEOS geometry operations support should be built in" ON)
option(WITH_OGR "Choose if OGR/GDAL input vector support should be built in" ON)
option(WITH_CGI "Choose if CGI executable should be built" ON)
option(WITH_FCGI "Choose if CGI executable should support FastCGI" ON)
option(WITH_VERSION_STRING "Show MapCache in server version string" ON)
option(WITH_APACHE "Build Apache Module" ON)</pre>
</div>
<ul>
<li><p class="first"><strong>Pixman</strong> (<em>recommended</em>, from 0.5 onwards)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_PIXMAN<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>Pixman is a pixel manipulation library used to assemble image tiles when
responding to non-tiled wms requests. Pixman support is recommended as it is
highly optimized and will take advantage of recent processor extensions (mms,
sse, ...) to speed up blending and resampling operations. In case the pixman
library is not found, Mapcache will fall back to internal pixel operations
that are slower.</p>
</li>
<li><p class="first"><strong>Sqlite</strong> (<em>optional</em>, from 0.5 onwards)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_SQLITE<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>Sqlite is used to enable the sqlite and mbtiles cache backend. version 3.5.0
or newer is required.</p>
</li>
<li><p class="first"><strong>GDAL</strong> (<em>optional</em>, from 0.4 onwards, also requires geos)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_OGR<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>Gdal (actually ogr) is used by the seeding utility to allow the seeding of
tiles only intersecting a given polygon, e.g.  to preseed all the tiles of a
given country.</p>
</li>
<li><p class="first"><strong>GEOS</strong> (<em>optional</em>, from 0.5 onwards)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_GEOS<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>Along with gdal/ogr, geos is needed by the seeder to test for the intersection
of tiles with geographical features. A sufficiently recent version of geos (with
support for prepared geometries) is required (but not enforced by the configure
script, so you&#8217;ll end up with compilation errors if a too old geos version is
used)</p>
</li>
<li><p class="first"><strong>PCRE</strong> (<em>optional</em>)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_PCRE<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>Pcre (perl compatible regular expressions) can be used instead of posix regular
expressions for validating WMS dimensions.  they are more powerfull than posix
REs (and might be slower). You don&#8217;t need this if you aren&#8217;t planning on using
WMS dimension support with regex validation, or if your validation needs are
covered by posix REs.</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">也可以参考</p>
<p class="last"><a class="reference internal" href="dimensions.html#mapcache-dimensions"><em>Tileset Dimensions</em></a></p>
</div>
</li>
<li><p class="first"><strong>FastCGI Support</strong> (<em>optional</em>)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_FCGI<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>MapCache can run as a fastcgi executable. Note that the overhead of fastcgi
is non-negligeable with respect to the throughput you may obtain with a native
apache module. The fastcgi build is less tested, and may lag behind
compared to the apache module version on some minor details, YMMV.</p>
</li>
<li><p class="first"><strong>TIFF read/write Cache Support</strong> (<em>optional</em>)</p>
<p>Use TIFFs as a cache backend (READONLY) :</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_TIFF<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>TIFF write support (for creating new TIFF files and adding tiles to existing
TIFF files) is still experimental and disabled by default. There is a risk in
ending up with corrupt TIFF files if they are placed on a filesystem that does
not honour file locking, as in that case multiple processes might end up writing
to the same file. File locking across concurrent threads is also problematic,
although MapCache tries to detect this situation and apply sufficient locking
workarounds. To stay on the safe side, write support should for now only be
enabled on local filesystems, with a prefork mpm or fastcgi MapCache install.</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_TIFF_WRITE_SUPPORT<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>When writing TIFF files, MapCache can also optionally add georeferencing
information if compiled with libtiff support. GeoTiff writing does not
produce the full tags needed for defining which preojection the grid is
in, but will only produce those defining the pixel scale and the tiepoints
(i.e. the equivalent information found in the accompanying .tfw files)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_GEOTIFF<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<div class="admonition- admonition seealso">
<p class="first admonition-title">也可以参考</p>
<p class="last"><a class="reference internal" href="caches.html#mapcache-cache-tiff"><em>(Geo)TIFF Caches</em></a></p>
</div>
</li>
<li><p class="first"><strong>Memcached Cache Support</strong> (<em>optional</em>)</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_MEMCACHE<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>The memcached cache backend is disabled by default. You can optionally enable it as
it does not depend on other external libraries (support is obtained through apr-util).</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">也可以参考</p>
<p class="last"><a class="reference internal" href="caches.html#mapcache-cache-memcache"><em>Memcache Caches</em></a></p>
</div>
</li>
<li><p class="first"><strong>Apache Module Options</strong></p>
<p>You can disable the apache module building if you only plan on using the
fastcgi executable or the seeder.</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_APACHE<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>MapCache adds itself to the version string reported by the apache server. This
can be disabled with</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_VERSION_STRING<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Native MapServer Mode</strong> (<em>experimental options</em>)</p>
<p>MapCache is by default not linked to MapServer in any way, and communicates
through the WMS protocol only. For performance reasons, there is a possibility
to directly use the mapserver C library and avoid an http request and an image
compression/decompression. This integration is still experimental and should
be used cautiously</p>
<div class="highlight-bash"><div class="highlight"><pre>-DWITH_MAPSERVER<span class="o">=[</span>0|1<span class="o">]</span>
</pre></div>
</div>
<p>This will use the libmapserver.so from mapserver&#8217;s install directory. MapServer
itself should be compiled with thread-safety enabled, unless you plan use the
prefork mpm or fastcgi, <strong>and</strong> you do not plan to use the seeder. For thread
safety on the mapserver side, you might want to have a look at tickets #4041
and #4044.</p>
</li>
<li><p class="first"><strong>Debug Mode</strong> (<em>work in progress</em>)</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Since the cmake migration, this has to be done.</p>
</div>
<p>It enables some extra tests inside the code, and prints out many more debugging
messages to the server logs. you should probably not enable this unless you
want to track down a problem happening inside MapCache.</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="windows-instructions">
<h2><a class="toc-backref" href="#table-of-contents">Windows Instructions</a><a class="headerlink" href="#windows-instructions" title="永久链接至标题">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The following instructions are outdated, Windows builds are now handled
identically to the Unix ones with cmake.</p>
</div>
<p>These instructions target a Windows 7 setup with an Apache httpd compiled from
source. The Apache MapCache module has been successfully built with with
Microsoft Visual Studio C++ versions 2003, 2008 and 2010.</p>
<div class="section" id="dependencies">
<h3><a class="toc-backref" href="#table-of-contents">Dependencies</a><a class="headerlink" href="#dependencies" title="永久链接至标题">¶</a></h3>
<p>Required:</p>
<ul class="simple">
<li><strong>Apache / APR / APR-UTIL</strong>: included with apache httpd installation</li>
</ul>
<p>Those can be installed manually, or using the appropriate Windows SDK
from: <a class="reference external" href="http://vbkto.dyndns.org/sdk/">http://vbkto.dyndns.org/sdk/</a></p>
<ul class="simple">
<li><strong>PNG</strong></li>
<li><strong>JPEG</strong></li>
<li><strong>CURL</strong></li>
</ul>
<p>Recommended:</p>
<ul class="simple">
<li><strong>PCRE</strong>: <a class="reference external" href="ftp://ftp.gnu.org/pub/gnu/regex/regex-0.12.tar.gz">ftp://ftp.gnu.org/pub/gnu/regex/regex-0.12.tar.gz</a></li>
</ul>
<p>Optional:</p>
<ul class="simple">
<li><strong>FCGI</strong>: Needed to build a fastcgi program if you don&#8217;t want to run
mapcache as an apache module.</li>
<li><strong>GDAL / GEOS</strong>: Needed to enable advanced seeding options (for only
seeding tiles that intersect a given geographical feature)</li>
<li><strong>SQLITE</strong>: For enabling the sqlite backend storages</li>
<li><strong>TIFF</strong>: For enabling the TIFF backend storages</li>
</ul>
</div>
<div class="section" id="configure-your-makefile">
<h3><a class="toc-backref" href="#table-of-contents">Configure Your Makefile</a><a class="headerlink" href="#configure-your-makefile" title="永久链接至标题">¶</a></h3>
<p>Open nmake.opt and modify the paths to point to the various libraries.</p>
</div>
<div class="section" id="compilation">
<h3><a class="toc-backref" href="#table-of-contents">Compilation</a><a class="headerlink" href="#compilation" title="永久链接至标题">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>nmake /f Makefile.vc
</pre></div>
</div>
<p>If successful, the resulting libraries and executables will be generated in their associated
directories:</p>
<dl class="docutils">
<dt>apache/</dt>
<dd>Apache module (mod_mapcache.dll)</dd>
<dt>cgi/</dt>
<dd>FastCGI MapCache executable (mapcache.exe)</dd>
<dt>util/</dt>
<dd>MapCache utilities (mapcache_seed.exe)</dd>
</dl>
</div>
<div class="section" id="move-the-module-into-apache-directory">
<h3><a class="toc-backref" href="#table-of-contents">Move the Module into Apache Directory</a><a class="headerlink" href="#move-the-module-into-apache-directory" title="永久链接至标题">¶</a></h3>
<p>Copy the <em>mod_mapcache.dll</em> file into one of your Apache subdirectories.</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">Although other modules are installed into <em>/Apache/modules/</em>, you should place
mod_mapcache.dll wherever its required dll files (libcurl.dll, zlib.dll, etc.) live,
to avoid any loading issues later on.</p>
</div>
</div>
<div class="section" id="configure-your-installed-apache">
<h3><a class="toc-backref" href="#table-of-contents">Configure Your Installed Apache</a><a class="headerlink" href="#configure-your-installed-apache" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">Modify your <em>httpd.conf</em> file to load the module:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">LoadModule</span> mapcache_module <span class="s2">&quot;D:/ms4w/Apache/cgi-bin/mod_mapcache.dll&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Next, configure your mapcache directory with the following
snippet</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nt">&lt;IfModule</span> <span class="s">mapcache_module</span><span class="nt">&gt;</span>
   <span class="nt">&lt;Directory</span> <span class="s">&quot;D:/ms4w/apps/mapcache/&quot;</span><span class="nt">&gt;</span>
      <span class="nb">Order</span> Allow,Deny
      <span class="nb">Allow</span> from <span class="k">all</span>
   <span class="nt">&lt;/Directory&gt;</span>
   <span class="nb">MapCacheAlias</span> <span class="sx">/mapcache</span> <span class="s2">&quot;D:/ms4w/apps/mapcache/mapcache.xml&quot;</span>
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Configure your <em>mapcache.xml</em> file (see the <a class="reference internal" href="config.html#mapcache-config"><em>Configuration</em></a> section
for help)</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>If you receive an error such as &#8220;cache disk: host system does not support file symbolic linking&#8221;
you should comment the line &#8220;&lt;symlink_blank/&gt;&#8221; in your mapcache.xml file, such as:</p>
<div class="last highlight-bash"><div class="highlight"><pre>&lt;cache <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;disk&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;disk&quot;</span>&gt;
  &lt;base&gt;D:/ms4w/tmp/ms_tmp/cache&lt;/base&gt;
  &lt;!--&lt;symlink_blank/&gt;--&gt;
&lt;/cache&gt;
</pre></div>
</div>
</div>
<ul>
<li><p class="first">Finally, restart your Apache.  You should see a message in Apache&#8217;s error.log with a message
similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>notice<span class="o">]</span> Apache/2.2.21 <span class="o">(</span>Win32<span class="o">)</span> mod-mapcache/0.5-dev configured -- resuming normal operations
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="test-your-mapcache-module">
<h3><a class="toc-backref" href="#table-of-contents">Test Your MapCache Module</a><a class="headerlink" href="#test-your-mapcache-module" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">In your web browser, goto the local MapCache demo page: <a class="reference external" href="http://127.0.0.1/mapcache/demo/">http://127.0.0.1/mapcache/demo/</a> You should see
a clickable list of demo links:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tms</span>
<span class="n">wmts</span>
<span class="n">gmaps</span>
<span class="n">kml</span>
<span class="n">ve</span>
<span class="n">wms</span>
</pre></div>
</div>
</li>
<li><p class="first">Click on one of the demos (such as <a class="reference external" href="http://127.0.0.1/mapcache/demo/wmts">http://127.0.0.1/mapcache/demo/wmts</a>), a map viewer should load, similar
to the image below.</p>
<img alt="../_images/mapcache-demo.jpg" src="../_images/mapcache-demo.jpg" style="width: 900px; height: 600px;" />
</li>
<li><p class="first">Zoom in a few times, and your configured cache location should be generating tiles (in this case inside
D:/ms4w/tmp/ms_tmp/cache/).</p>
<img alt="../_images/mapcache-disk.jpg" src="../_images/mapcache-disk.jpg" />
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<p>
<a href="../about.html" title="About">About</a><br>
<a href="../products.html" title="Products">Products</a><br>
<a href="../community/index.html" title="Community">Community</a><br>
<a href="../development/index.html" title="Development">Development</a><br>
<a href="../download.html" title="Downloads">Downloads</a><br>
<a href="../documentation.html" title="Documentation">Documentation</a><br>
<a href="../faq.html" title="FAQ">FAQ</a>
</p>
  <h3>Current Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Compilation &amp; Installation</a><ul>
<li><a class="reference internal" href="#getting-the-source">Getting the Source</a></li>
<li><a class="reference internal" href="#linux-instructions">Linux Instructions</a><ul>
<li><a class="reference internal" href="#apache-module-specific-instructions">Apache Module Specific Instructions</a></li>
<li><a class="reference internal" href="#nginx-specific-instructions">Nginx Specific Instructions</a></li>
<li><a class="reference internal" href="#cgi-fastcgi-specific-instructions">CGI/FastCGI Specific Instructions</a></li>
<li><a class="reference internal" href="#customizing-the-build-or-if-something-went-wrong">Customizing the build, or if something went wrong</a><ul>
<li><a class="reference internal" href="#options-supported-by-the-mapcache-cmake-builder">Options supported by the MapCache cmake builder</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#windows-instructions">Windows Instructions</a><ul>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li><a class="reference internal" href="#configure-your-makefile">Configure Your Makefile</a></li>
<li><a class="reference internal" href="#compilation">Compilation</a></li>
<li><a class="reference internal" href="#move-the-module-into-apache-directory">Move the Module into Apache Directory</a></li>
<li><a class="reference internal" href="#configure-your-installed-apache">Configure Your Installed Apache</a></li>
<li><a class="reference internal" href="#test-your-mapcache-module">Test Your MapCache Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li><a href="../index.html">Home</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">版权所有</a> 2014, Regents of the University of Minnesota.
      最后更新日期是 2014 年 04 月 10 日.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>